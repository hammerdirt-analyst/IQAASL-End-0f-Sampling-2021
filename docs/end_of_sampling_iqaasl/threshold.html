
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7. Calculating baseline values &#8212; Summary and analysis</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Alpes Valaisannes (AV)" href="alpes_valaisannes.html" />
    <link rel="prev" title="6. Transport: an empirical approach" href="assessing_transport.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/new_logox.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Summary and analysis</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Identification, quantification and analysis of observable anthropogenic debris along swiss river and lakes (IQAASL)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tools and methods
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="key_indicators.html">
   1. Key statistical indicators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="land_use_correlation.html">
   2. The land use profile
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code_groups.html">
   3. Code groups
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../references.html">
   4. References
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Findings
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="slr_2017.html">
   5. More and less trash since 2018
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assessing_transport.html">
   6. Transport: an empirical approach
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   7. Calculating baseline values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="alpes_valaisannes.html">
   8. Alpes Valaisannes (AV)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Survey results
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="eos_asa.html">
   9. All survey areas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aare_sa.html">
   10. Aare survey area
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linth_sa.html">
   11. Linth survey area
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ticino_sa.html">
   12. Ticino survey area
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rhone_sa.html">
   13. Rh√¥ne survey area
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/end_of_sampling_iqaasl/threshold.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hammerdirt-analyst/IQAASL-End-0f-Sampling-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/hammerdirt-analyst/IQAASL-End-0f-Sampling-2021/issues/new?title=Issue%20on%20page%20%2Fend_of_sampling_iqaasl/threshold.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hammerdirt-analyst/IQAASL-End-0f-Sampling-2021/main?urlpath=tree/docs/end_of_sampling_iqaasl/threshold.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-data">
   7.1. The data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#identifying-extreme-values">
     7.1.1. Identifying extreme values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adjusted-boxplots">
       7.1.1.1. Adjusted boxplots
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modeling">
       7.1.1.2. Modeling
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#nb-method-of-moments">
         7.1.1.2.1. NB method of moments
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confidence-intervals">
     7.1.2. Confidence intervals
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bootstrap-methods">
       7.1.2.1. Bootstrap methods:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     7.1.3. Discussion
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#thresholds">
       7.1.3.1. Thresholds
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#number-of-samples">
     7.1.4. Number of samples
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#extreme-values">
       7.1.4.1. Extreme values
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quality-people-quality-data">
       7.1.4.2. Quality people = quality data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#objective-criteria-protocols-and-analysis">
       7.1.4.3. Objective criteria, protocols and analysis
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sys, file and nav packages:</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>

<span class="c1"># math packages:</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.distributions.empirical_distribution</span> <span class="kn">import</span> <span class="n">ECDF</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">medcouple</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># charting:</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># home brew utitilties</span>
<span class="kn">import</span> <span class="nn">resources.utility_functions</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">resources.chart_kwargs</span> <span class="k">as</span> <span class="nn">ck</span>
<span class="kn">import</span> <span class="nn">resources.sr_ut</span> <span class="k">as</span> <span class="nn">sut</span>

<span class="c1"># images and display</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Math</span><span class="p">,</span> <span class="n">Latex</span>

<span class="c1"># set some parameters:</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;2020-03-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span><span class="s1">&#39;2021-05-31&#39;</span>

<span class="c1"># name of the output folder:</span>
<span class="n">name_of_project</span> <span class="o">=</span> <span class="s1">&#39;threshold_values&#39;</span>

<span class="c1"># the scale for pieces per meter and the column and chart label for the units</span>
<span class="n">reporting_unit</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">unit_label</span> <span class="o">=</span> <span class="s1">&#39;p/100m&#39;</span>

<span class="c1"># add the folder to the directory tree:</span>
<span class="n">project_directory</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">make_project_folder</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">name_of_project</span><span class="p">)</span>

<span class="c1"># get your data:</span>
<span class="n">survey_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;resources/results_with_land_use_2015.csv&#39;</span><span class="p">)</span>
<span class="n">river_bassins</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">json_file_get</span><span class="p">(</span><span class="s2">&quot;resources/river_basins.json&quot;</span><span class="p">)</span>
<span class="n">dfBeaches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/beaches_with_land_use_rates.csv&quot;</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/codes_with_group_names_2015.csv&quot;</span><span class="p">)</span>
<span class="n">dfDims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/dims_data.csv&quot;</span><span class="p">)</span>

<span class="c1"># set the index of the beach data to location slug</span>
<span class="n">dfBeaches</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># map locations to feature names</span>
<span class="n">location_wname_key</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="o">.</span><span class="n">water_name_slug</span>

<span class="c1"># map water_name_slug to water_name</span>
<span class="n">wname_wname</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="p">[[</span><span class="s1">&#39;water_name_slug&#39;</span><span class="p">,</span><span class="s1">&#39;water_name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">wname_wname</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;water_name_slug&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># convenience function for doing land use correlations</span>
<span class="k">def</span> <span class="nf">make_plot_with_spearmans</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">corr</span><span class="p">,</span> <span class="n">a_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">unit_label</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">a_p</span>

<span class="c1"># index the code data</span>
<span class="n">dfCodes</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># these descriptions need to be shortened for display</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G74&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Insulation: includes spray foams&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G940&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Foamed EVA for crafts and sports&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G96&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Sanitary-pads/tampons, applicators&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G178&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Metal bottle caps and lids&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G82&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Expanded foams 2.5cm - 50cm&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G81&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Expanded foams .5cm - 2.5cm&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G117&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Expanded foams &lt; 5mm&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G75&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic/foamed polystyrene 0 - 2.5cm&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G76&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic/foamed polystyrene 2.5cm - 50cm&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G24&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic lid rings&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G33&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Lids for togo drinks plastic&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G3&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic bags, carier bags&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">([</span><span class="s2">&quot;G204&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Bricks, pipes not plastic&quot;</span><span class="p">],</span> <span class="n">dfCodes</span><span class="p">)</span>

<span class="c1"># make a map to the code descriptions</span>
<span class="n">code_description_map</span> <span class="o">=</span> <span class="n">dfCodes</span><span class="o">.</span><span class="n">description</span>

<span class="c1"># make a map to the code descriptions</span>
<span class="n">code_material_map</span> <span class="o">=</span> <span class="n">dfCodes</span><span class="o">.</span><span class="n">material</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="calculating-baseline-values">
<span id="threshhold"></span><h1><span class="section-number">7. </span>Calculating baseline values<a class="headerlink" href="#calculating-baseline-values" title="Permalink to this headline">¬∂</a></h1>
<p>Similar to survey results in the marine environment beach-litter-data in Switzerland is highly variable. With values ranging from zero (two surveys in 2020 had a quantity of zero), to thousands of objects and fragments within 100m coastline. The <em>JRC Technical Report: A European threshold value</em> <span id="id1">[<a class="reference internal" href="../references.html#id31">HG19</a>]</span> suggests several methods for calculating threshold values, confidence intervals and extreme values. Examples of the proposed methods are applied to the survey results from IQAASL.</p>
<p><strong>Assumptions:</strong></p>
<ul class="simple">
<li><p>The more trash there is on the ground the more a person is likely to find</p></li>
<li><p><strong>The survey results represent the minimum amount of trash at that site</strong></p></li>
<li><p>For each survey: finding one item does not effect the chance of finding another</p></li>
</ul>
<div class="section" id="the-data">
<h2><span class="section-number">7.1. </span>The data<a class="headerlink" href="#the-data" title="Permalink to this headline">¬∂</a></h2>
<p>Only surveys with a length greater than ten meters and less than 100 meters are included in the baseline calculation. The available space to survey in urban or suburban environments is limited, changes in the lake level and wave action can have significant effects on the available space to survey, including reducing the length of available shoreline. In IQAASL the policy was to avoid doing surveys less than ten meters. Note that this does not exclude all surveys from a location, only those that were less than ten meters.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the final survey data set here:</span>
<span class="n">a_data</span> <span class="o">=</span> <span class="n">survey_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># make a loc_date column from the survey data</span>
<span class="c1"># before converting to timestamp</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">a_data</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>

<span class="c1"># convert string dates from .csv to timestamp</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># slice by start- end date</span>
<span class="n">a_data</span> <span class="o">=</span> <span class="n">a_data</span><span class="p">[(</span><span class="n">a_data</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">)]</span>

<span class="c1"># combine lugano and maggiore</span>
<span class="c1"># if the river bassin name does not equal tresa leave it, else change it to ticino</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;river_bassin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">river_bassin</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">!=</span> <span class="s1">&#39;tresa&#39;</span><span class="p">,</span> <span class="s1">&#39;ticino&#39;</span> <span class="p">)</span>

<span class="c1"># assign the reporting value</span>
<span class="n">a_data</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">pcs_m</span> <span class="o">*</span> <span class="n">reporting_unit</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># scale the streets to kilometers</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;streets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">streets</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;streets km&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">streets</span><span class="o">/</span><span class="mi">1000</span>

<span class="c1"># save the data before aggregating to test</span>
<span class="n">before_agg</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Combine the different sizes of fragmented plastics and styrofoam</span>
<span class="c1"># the codes for the foams</span>
<span class="n">some_foams</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;G81&#39;</span><span class="p">,</span> <span class="s1">&#39;G82&#39;</span><span class="p">,</span> <span class="s1">&#39;G83&#39;</span><span class="p">]</span>

<span class="c1"># the codes for the fragmented plastics</span>
<span class="n">some_frag_plas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a_data</span><span class="p">[</span><span class="n">a_data</span><span class="o">.</span><span class="n">groupname</span> <span class="o">==</span> <span class="s1">&#39;plastic pieces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># this extracts and aggregates the members of the two code groups, returns a dataframe</span>
<span class="n">the_plast_rows</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">create_aggregate_groups</span><span class="p">(</span><span class="n">a_data</span><span class="p">,</span> <span class="n">codes_to_agg</span><span class="o">=</span><span class="n">some_frag_plas</span><span class="p">,</span><span class="n">a_model_code</span><span class="o">=</span><span class="s2">&quot;G79&quot;</span><span class="p">,</span> <span class="n">a_new_code</span><span class="o">=</span><span class="s2">&quot;Gfrags&quot;</span><span class="p">)</span>
<span class="n">the_foam_rows</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">create_aggregate_groups</span><span class="p">(</span><span class="n">a_data</span><span class="p">,</span> <span class="n">codes_to_agg</span><span class="o">=</span><span class="n">some_foams</span><span class="p">,</span> <span class="n">a_model_code</span><span class="o">=</span><span class="s2">&quot;G82&quot;</span><span class="p">,</span> <span class="n">a_new_code</span><span class="o">=</span><span class="s2">&quot;Gfoam&quot;</span><span class="p">)</span>

<span class="c1"># the foam codes and fragmented plastic codes have been aggregated in to Gfrags and Gfoam</span>
<span class="n">a_data</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">replace_a_group_of_codes_with_one</span><span class="p">(</span><span class="n">a_data</span><span class="p">,</span> <span class="n">new_code_values</span><span class="o">=</span><span class="p">[</span><span class="n">the_plast_rows</span><span class="p">,</span> <span class="n">the_foam_rows</span><span class="p">],</span> <span class="n">codes_to_replace</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">some_frag_plas</span><span class="p">,</span> <span class="o">*</span><span class="n">some_foams</span><span class="p">])</span>

<span class="c1"># gather the dimensional data for the time frame from dfDims</span>
<span class="c1"># match records to survey data</span>
<span class="n">fd_dims</span><span class="o">=</span> <span class="n">dfDims</span><span class="p">[(</span><span class="n">dfDims</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dfDims</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dfDims</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># make a loc_date column and get the unique values</span>
<span class="n">fd_dims</span><span class="p">[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fd_dims</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">fd_dims</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>

<span class="c1"># map the survey area name to the dims data record</span>
<span class="n">a_map</span> <span class="o">=</span> <span class="n">fd_dims</span><span class="p">[[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;loc_date&#39;</span><span class="p">)</span>
<span class="n">l_map</span> <span class="o">=</span> <span class="n">fd_dims</span><span class="p">[[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;loc_date&#39;</span><span class="p">)</span>

<span class="c1"># map length and area from dims to survey data</span>
<span class="k">for</span> <span class="n">a_survey</span> <span class="ow">in</span> <span class="n">fd_dims</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">a_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a_data</span><span class="o">.</span><span class="n">loc_date</span> <span class="o">==</span> <span class="n">a_survey</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_survey</span><span class="p">],</span> <span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a_data</span><span class="o">.</span><span class="n">loc_date</span> <span class="o">==</span> <span class="n">a_survey</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_survey</span><span class="p">],</span> <span class="s1">&#39;area&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># exclude surveys less than 10 meters</span>
<span class="n">gten_lhun</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">a_data</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># this is a common aggregation</span>
<span class="n">agg_pcs_quantity</span> <span class="o">=</span> <span class="p">{</span><span class="n">unit_label</span><span class="p">:</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">:</span><span class="s1">&#39;sum&#39;</span><span class="p">}</span>

<span class="c1"># survey totals by location</span>
<span class="n">dt_all</span> <span class="o">=</span> <span class="n">gten_lhun</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;loc_date&#39;</span><span class="p">,</span><span class="s1">&#39;location&#39;</span><span class="p">,</span><span class="s1">&#39;river_bassin&#39;</span><span class="p">,</span> <span class="s1">&#39;water_name_slug&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_pcs_quantity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="identifying-extreme-values">
<h3><span class="section-number">7.1.1. </span>Identifying extreme values<a class="headerlink" href="#identifying-extreme-values" title="Permalink to this headline">¬∂</a></h3>
<p>Extreme values are identified but not excluded from the baseline or confidence level calculations. The identification of extreme values is to ensure that extreme data are verified on a case by case basis and to apply the median for calculating baseline statistics. <span id="id2">[<a class="reference internal" href="../references.html#id31">HG19</a>]</span></p>
<p>The occurrence of extreme values can influence the average of the data and the interpretation of survey results. According the to the JRC report:</p>
<blockquote>
<div><p>The methodology for the identification of extreme values can be either expert judgement, or be based on statistical and modelling approaches, such as the application of Tukey‚Äôs box plots to detect potential outliers. For skewed distributions, the adjusted box plot is more appropriate. <span id="id3">[<a class="reference internal" href="../references.html#id31">HG19</a>]</span></p>
</div></blockquote>
<div class="section" id="adjusted-boxplots">
<h4><span class="section-number">7.1.1.1. </span>Adjusted boxplots<a class="headerlink" href="#adjusted-boxplots" title="Permalink to this headline">¬∂</a></h4>
<p>Tukey‚Äôs boxplot is used to visualize the distribution of a univariate data set. The samples that fall within the first quartile (<span class="math notranslate nohighlight">\(Q_1\)</span>) and the third quartile (<span class="math notranslate nohighlight">\(Q_3\)</span>) are considered to be within the innerquartial range (IQR) = <span class="math notranslate nohighlight">\(Q_3 - Q_1\)</span>. Points out side of the inner quartile range are considered outliers if their value is greater or less than one of two limits:</p>
<ul class="simple">
<li><p>lower limit = <span class="math notranslate nohighlight">\(Q_1 - (1.5*IQR)\)</span></p></li>
<li><p>upper limit = <span class="math notranslate nohighlight">\(Q_3 + (1.5*IQR)\)</span></p></li>
</ul>
<p>Adusting the boxplot involves replacing the constant 1.5 with another parameter. This parameter is calculated using a method called the <em>medcouple</em> (MC) and applying the result of that method to the constant 1.5. <span id="id4">[<a class="reference internal" href="../references.html#id47">HV08</a>]</span> <span id="id5">[<a class="reference internal" href="../references.html#id48">SP</a>]</span> The new calculation looks like this:</p>
<ul class="simple">
<li><p>lower limit = <span class="math notranslate nohighlight">\(Q_1 - (1.5e^{-4MC}*IQR)\)</span></p></li>
<li><p>upper limit = <span class="math notranslate nohighlight">\(Q_3 + (1.5e^{3MC}*IQR)\)</span></p></li>
</ul>
<p><em>The limit at which a survey is conisdered <em>extreme</em> extends to the 98th percentile when the boxplots are adjusted as opposed to the 90th percentile if the constant is left at 1.5.</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># implementation of medcouple</span>
<span class="n">a_whis</span> <span class="o">=</span> <span class="n">medcouple</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

<span class="c1"># get the ecdf </span>
<span class="n">ecdf</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

<span class="c1"># quantiles and IQR of the data</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>

<span class="c1"># the upper and lower limit of extreme values unadjusted:</span>
<span class="n">limit_lower</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span>
<span class="n">limit_upper</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span>

<span class="c1"># the upper and lower limit of extreme values adjusted:</span>
<span class="n">a_fence</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a_whis</span><span class="p">))))</span><span class="o">*</span><span class="n">iqr</span>
<span class="n">a_2fence</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">a_whis</span><span class="p">))))</span><span class="o">*</span><span class="n">iqr</span>

<span class="c1"># source = https://stackoverflow.com/questions/12127635/matplotlib-can-we-draw-a-histogram-and-a-box-plot-on-a-same-chart</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Add a graph in each part</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>

<span class="c1"># get the limits of the x and y axix</span>
<span class="n">xamax</span> <span class="o">=</span> <span class="n">ax_hist</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">y_max</span><span class="o">=</span> <span class="n">ax_hist</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

<span class="c1"># no xlabel on the top axis</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="c1"># fill the areas concerened by each limt</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">limit_upper</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">y_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;upper limit boxplot&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">a_2fence</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">y_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;upper limit adjusted&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">ax_box</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">limit_upper</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">ax_box</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">ax_box</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;upper limit boxplot&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">a_2fence</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">ax_box</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">ax_box</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;upper limit adjusted&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># get legend</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax_box</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/threshold_6_0.png" src="../_images/threshold_6_0.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<p><em>The diffrence between adjusted and normal boxplots. Adjusted = 1792 p/100m,  unadjusted = 708 p/100m.</em></p>
</div>
</div>
</div>
<div class="section" id="modeling">
<h4><span class="section-number">7.1.1.2. </span>Modeling<a class="headerlink" href="#modeling" title="Permalink to this headline">¬∂</a></h4>
<p>Extreme values can be indentified by assuming the data belong to some underlying known statistical distribution. Count data is often modeled using a poisson distribution, however this is only valid where variance is equal to the mean. The data from IQAASL and beach-litter data in general do not meet this criteria, the negative binomial (NB) distribution allows for the variance to be greater than the mean. <span id="id6">[<a class="reference internal" href="../references.html#id49">CT99</a>]</span> <span id="id7">[<a class="reference internal" href="../references.html#id50">Wei20</a>]</span></p>
<blockquote>
<div><p>The modelling approach for the identification of extreme values is then performed by fitting the NB-distribution to the data by means of maximum likelihood and tagging all values in the right tail as potentially extreme values if the probability that they belong to the fitted NB-distribution is less than, e.g. 0.001. <span id="id8">[<a class="reference internal" href="../references.html#id33">VLW20</a>]</span></p>
</div></blockquote>
<div class="section" id="nb-method-of-moments">
<h5><span class="section-number">7.1.1.2.1. </span>NB method of moments<a class="headerlink" href="#nb-method-of-moments" title="Permalink to this headline">¬∂</a></h5>
<p>Modeling data is a vast domain and many fields and industries have developed specific algorythms using parameters from known relationships. The techniques from the MSFD are for greater temporal and spatial ranges than those defined by the IQAASL. The purpose of modeling for this example is to simply identify probable extreme values of aggregated data, a generalist approach by definition.</p>
<p>Fitting the NB distribution has all to do with estimating parameters, <em>maximum likelihood estimation</em> can be an involved process. The method of moments produces comparable results and the parameters can be taken from the data <span id="id9">[<a class="reference internal" href="../references.html#id51">LS07</a>]</span> <span id="id10">[<a class="reference internal" href="../references.html#id52">nbi</a>]</span> <span id="id11">[<a class="reference internal" href="../references.html#id53">Ove</a>]</span>.  The ratio of distributed objects to contributed objects is used to parametrize the distribution, see <em>Asessing transport</em> for details. There are several basic statistical packages that cover this use, the examples here and elsewhere in this publication come from SciPy and statsmodels. <span id="id12">[<a class="reference internal" href="../references.html#id54">VGO+20</a>]</span> <span id="id13">[<a class="reference internal" href="../references.html#id48">SP</a>]</span></p>
<p><em>Estimating the parameters of the underlying NB distribution using the mean and the variance from the observed values</em></p>
<p><em>implementation: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.nbinom.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.nbinom.html</a></em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the data to model</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># whiskers for the boxplots</span>
<span class="n">a_whis</span> <span class="o">=</span> <span class="n">medcouple</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="c1"># the ratio of distributed items to contributed items in rural locations:</span>
<span class="c1"># see the assessing transport notebook for a complete epxlanation</span>
<span class="n">dispersion_param</span> <span class="o">=</span> <span class="mf">1.7</span>

<span class="c1"># the variance</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="c1"># the average</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="c1"># dispersion</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="o">/</span><span class="n">var</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">var</span><span class="o">-</span><span class="n">mean</span><span class="p">))</span><span class="o">*</span><span class="n">dispersion_param</span>

<span class="c1"># point estimates from for the 98 and 90 %ile</span>
<span class="n">rv</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">sim_98</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.98</span><span class="p">)</span>
<span class="n">obs_98</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="mf">.98</span><span class="p">)</span>

<span class="n">sim_90</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.9</span><span class="p">)</span>
<span class="n">obs_90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="mf">.9</span><span class="p">)</span>

<span class="c1"># simulated data</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>
<span class="n">a_whis</span> <span class="o">=</span> <span class="n">medcouple</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c1"># quantiles and IQR of the data</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="mi">75</span><span class="p">)</span>
<span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>

<span class="c1"># the upper and lower limit of extreme values unadjusted:</span>
<span class="n">limit_lower</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span>
<span class="n">limit_upper</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span>

<span class="c1"># the upper and lower limit of extreme values adjusted:</span>
<span class="n">a_fence</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a_whis</span><span class="p">))))</span><span class="o">*</span><span class="n">iqr</span>
<span class="n">a_2fence</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">a_whis</span><span class="p">))))</span><span class="o">*</span><span class="n">iqr</span>

<span class="c1"># format data for charting</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">unit_label</span><span class="p">:</span><span class="n">vals</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;observed&#39;</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">unit_label</span><span class="p">:</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;simulated&#39;</span><span class="p">}))</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">axone</span><span class="p">,</span> <span class="n">axtwo</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Add a graph in each part</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="s1">&#39;simulated&#39;</span><span class="p">][</span><span class="n">unit_label</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axone</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axtwo</span><span class="p">)</span>

<span class="c1"># get the limits of the x and y axis</span>
<span class="n">xamax</span> <span class="o">=</span> <span class="n">axtwo</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">y_max</span><span class="o">=</span> <span class="n">axtwo</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

<span class="c1"># no xlabel on the top axis</span>
<span class="n">axone</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="c1"># fill the areas concerened by each limit</span>
<span class="n">axtwo</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">limit_upper</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">y_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;lower limit simulated&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axtwo</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">a_2fence</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">y_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;upper limit simulated&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">axone</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">limit_upper</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">axone</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">axone</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;upper limit boxplot&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axone</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">a_2fence</span><span class="p">,</span><span class="n">xamax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y1</span><span class="o">=</span><span class="n">axone</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">axone</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;upper limit adjusted&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/threshold_10_0.png" src="../_images/threshold_10_0.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<p><em>Point estimate of the 98th percentile from simulated data = 2548 p/100m, estimate of the 90th percentile = 1366 p/100m</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="confidence-intervals">
<h3><span class="section-number">7.1.2. </span>Confidence intervals<a class="headerlink" href="#confidence-intervals" title="Permalink to this headline">¬∂</a></h3>
<p>Confidence intervals (CIs) help approximate or mitigate the uncertainty of beach-litter survey results. Another way to mitigate uncertainty is to have the appropriate number of samples for the region or area of interest. In the marine environment the recomended minimum number of surveys for each region is 40 if calculating CIs, after that there is only a limited gain in the improvement of the CI.<span id="id14">[<a class="reference internal" href="../references.html#id31">HG19</a>]</span></p>
<p>Even though the extreme values have been identified they are included in the data set for calcualting base lines and confidence intervals:</p>
<blockquote>
<div><p>It was agreed to leave the extreme data in the dataset, while highlighting the need to check to verify extreme data case by case and to apply the median for calculating of averages. This allows the use of all data while not skewing results through singleextraordinary high litter count surveys. <span id="id15">[<a class="reference internal" href="../references.html#id33">VLW20</a>]</span></p>
</div></blockquote>
<div class="section" id="bootstrap-methods">
<h4><span class="section-number">7.1.2.1. </span>Bootstrap methods:<a class="headerlink" href="#bootstrap-methods" title="Permalink to this headline">¬∂</a></h4>
<p>Bootstrapping is a resampling method that uses random sampling with replacement to repeat or simulate the sampling process. Bootstrapping permits the estimation of the sampling distribution of sample statistics using random sampling methods. <span id="id16">[<a class="reference internal" href="../references.html#id58">Wika</a>]</span> <span id="id17">[<a class="reference internal" href="../references.html#id46">JLGC19</a>]</span> <span id="id18">[<a class="reference internal" href="../references.html#id55">SS21</a>]</span></p>
<p>There are several computational methods to choose from such as percentile, BCa, and Student‚Äôs t to name a few. For this example two methods were tested:</p>
<ol class="simple">
<li><p>Percentile bootstrap</p></li>
<li><p>bias-corrected accelerated bootstrap confidence interval (BCa)</p></li>
</ol>
<p>The <em>percentile method</em> does not account for the <em>shape</em> of the underlying distribution and this can lead to confidence intervals that do not match the data. The BCa corrects that. The implementation of these methods is straight forward using the previously cited packages. <span id="id19">[<a class="reference internal" href="../references.html#id56">Efr87</a>]</span> <span id="id20">[<a class="reference internal" href="../references.html#id57">dry20</a>]</span> <span id="id21">[<a class="reference internal" href="../references.html#id44">Boi19</a>]</span></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># bootstrap percentile confidence intervals</span>

<span class="c1"># the number of reps</span>
<span class="n">n</span><span class="o">=</span><span class="mi">5000</span>

<span class="c1"># keep the observed values</span>
<span class="n">observed_median</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">observed_tenth</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">.15</span><span class="p">)</span>

<span class="c1"># place to keep the results from each resample</span>

<span class="c1"># for the median</span>
<span class="n">sim_medians</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># for the tenth percentile</span>
<span class="n">sim_ten</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># sample</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>    
    <span class="n">less</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dt_all</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
    <span class="n">the_median</span> <span class="o">=</span> <span class="n">less</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    <span class="n">the_10th</span> <span class="o">=</span> <span class="n">less</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">.15</span><span class="p">)</span>
    <span class="n">sim_medians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">the_median</span><span class="p">)</span>
    <span class="n">sim_ten</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">the_10th</span><span class="p">)</span>

<span class="c1"># get the upper and lower range of the sample median:</span>
<span class="n">g_25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_medians</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">g_975</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_medians</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>

<span class="c1"># get the upper and lower range of the tenth percentile:</span>
<span class="n">g_25_ten</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_ten</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">g_975_ten</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_ten</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>

<span class="n">caption</span> <span class="o">=</span> <span class="sa">F</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">**Confidence intervals calculated using the percentile method**</span>

<span class="s2">95% confidence interval of the median survey total and the 10th percentile:</span>

<span class="s2">*CI of the median:  observed=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">observed_median</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_label</span><span class="si">}</span><span class="s2">, lower limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">g_25</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_label</span><span class="si">}</span><span class="s2">, upper limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">g_975</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_label</span><span class="si">}</span><span class="s2">*</span>

<span class="s2">*CI of the 15th percentile:  observed=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">observed_tenth</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_label</span><span class="si">}</span><span class="s2">, lower limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">g_25_ten</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_label</span><span class="si">}</span><span class="s2">, upper limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">g_975_ten</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_label</span><span class="si">}</span><span class="s2">*</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">md</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><strong>Confidence intervals calculated using the percentile method</strong></p>
<p>95% confidence interval of the median survey total and the 10th percentile:</p>
<p><em>CI of the median:  observed=158.0 p/100m, lower limit=139.0 p/100m, upper limit=194.0 p/100m</em></p>
<p><em>CI of the 15th percentile:  observed=45.5 p/100m, lower limit=39.0 p/100m, upper limit=53.0 p/100m</em></p>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this code was modified from this source:</span>
<span class="c1"># http://bebi103.caltech.edu.s3-website-us-east-1.amazonaws.com/2019a/content/recitations/bootstrapping.html</span>
<span class="c1"># if you want to get the confidence interval around another point estimate use np.percentile</span>
<span class="c1"># and add the percentile value as a parameter</span>

<span class="k">def</span> <span class="nf">draw_bs_sample</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draw a bootstrap sample from a 1D data set.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">compute_jackknife_reps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns jackknife resampled replicates for the given data and statistical function&#39;&#39;&#39;</span>
    <span class="c1"># Set up empty array to store jackknife replicates</span>
    <span class="n">jack_reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="c1"># For each observation in the dataset, compute the statistical function on the sample</span>
    <span class="c1"># with that observation removed</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">jack_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_param</span><span class="p">:</span>
            <span class="n">jack_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">jack_sample</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jack_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">jack_sample</span><span class="p">,</span> <span class="n">stat_param</span><span class="p">)</span>          
        
    <span class="k">return</span> <span class="n">jack_reps</span>


<span class="k">def</span> <span class="nf">compute_a</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the acceleration constant a&#39;&#39;&#39;</span>

    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">x</span><span class="o">**-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span> <span class="p">(</span><span class="n">mean</span><span class="o">**-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span><span class="o">**</span><span class="mi">3</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)])</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">x</span><span class="o">**-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">mean</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">c</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">bootstrap_replicates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Computes n_reps number of bootstrap replicates for given data and statistical function&#39;&#39;&#39;</span>
    <span class="n">boot_reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_reps</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_reps</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_param</span><span class="p">:</span>
            <span class="n">boot_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">draw_bs_sample</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boot_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">draw_bs_sample</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">stat_param</span><span class="p">)</span>     
        
    <span class="k">return</span> <span class="n">boot_reps</span>


<span class="k">def</span> <span class="nf">compute_z0</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">boot_reps</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Computes z0 for given data and statistical function&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_param</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">stat_param</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">boot_reps</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">boot_reps</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">compute_bca_ci</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">alpha_level</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns BCa confidence interval for given data at given alpha level&#39;&#39;&#39;</span>
    <span class="c1"># Compute bootstrap and jackknife replicates</span>
    <span class="n">boot_reps</span> <span class="o">=</span> <span class="n">bootstrap_replicates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_reps</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">statfunction</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="n">stat_param</span><span class="p">)</span>
    <span class="n">jack_reps</span> <span class="o">=</span> <span class="n">compute_jackknife_reps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">statfunction</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="n">stat_param</span><span class="p">)</span>

    <span class="c1"># Compute a and z0</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">compute_a</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">compute_z0</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">boot_reps</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">statfunction</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="n">stat_param</span><span class="p">)</span>

    <span class="c1"># Compute confidence interval indices</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha_level</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">alpha_level</span><span class="o">/</span><span class="mf">2.</span><span class="p">])</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">+</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">alphas</span><span class="o">.</span><span class="n">shape</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span><span class="o">*</span><span class="n">z0</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    <span class="n">avals</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">z0</span> <span class="o">+</span> <span class="n">zs</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">zs</span><span class="p">))</span>
    <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">boot_reps</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">avals</span><span class="p">)</span>
    <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>

    <span class="c1"># Compute confidence interval</span>
    <span class="n">boot_reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">boot_reps</span><span class="p">)</span>
    <span class="n">ci_low</span> <span class="o">=</span> <span class="n">boot_reps</span><span class="p">[</span><span class="n">ints</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">ci_high</span> <span class="o">=</span> <span class="n">boot_reps</span><span class="p">[</span><span class="n">ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_high</span><span class="p">),</span> <span class="n">a</span>

<span class="n">upper_bca</span> <span class="o">=</span> <span class="n">compute_bca_ci</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="mf">.05</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">)</span>
<span class="n">lower_bca</span> <span class="o">=</span> <span class="n">compute_bca_ci</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="mf">.05</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">caption</span> <span class="o">=</span> <span class="sa">F</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">**Confidence intervals calcualted using BCa**</span>

<span class="s2">95% confidence interval of the median survey total and the 10th percentile:</span>

<span class="s2">*CI of the median:  observed=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">observed_median</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, lower limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">upper_bca</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, upper limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">upper_bca</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">*</span>

<span class="s2">*CI of the 15th percentile:  observed=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">observed_tenth</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, lower limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">lower_bca</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, upper limit=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">lower_bca</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">*</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">md</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><strong>Confidence intervals calcualted using BCa</strong></p>
<p>95% confidence interval of the median survey total and the 10th percentile:</p>
<p><em>CI of the median:  observed=158.0, lower limit=137.0, upper limit=188.0</em></p>
<p><em>CI of the 15th percentile:  observed=45.5, lower limit=39.0, upper limit=52.0</em></p>
</div>
</div>
</div>
</div>
<div class="section" id="discussion">
<h3><span class="section-number">7.1.3. </span>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¬∂</a></h3>
<p>The adoption of a standard measuring system and evaluation method is an important development. This allows for standardized analysis accross geographical regions and aggregation levels. Stakeholders now have an objective measurement and a method to measure.</p>
<ul class="simple">
<li><p>aggregate groups can analysed across regions</p></li>
<li><p>one time events can be compared to regional baselines</p></li>
</ul>
<p>This allows policy makers to measure the effects of current and past mitigation strategies. This report and the manner in which it was produced is one benefit of standardization.</p>
<div class="section" id="thresholds">
<h4><span class="section-number">7.1.3.1. </span>Thresholds<a class="headerlink" href="#thresholds" title="Permalink to this headline">¬∂</a></h4>
<p>The European Union has set a european wide threshold value of <span class="math notranslate nohighlight">\(\approx\)</span> 20p/100m based on data collected in 2015-2016. This value is based on the <span class="math notranslate nohighlight">\(15^{th}\)</span> percentile of the 2015-2016 results. In Switzerland the <span class="math notranslate nohighlight">\(15^{th}\)</span> percentile is between 39 and 53 p/100m for 2020-2021 with a median between 136 and 188p/100m.</p>
</div>
</div>
<div class="section" id="number-of-samples">
<h3><span class="section-number">7.1.4. </span>Number of samples<a class="headerlink" href="#number-of-samples" title="Permalink to this headline">¬∂</a></h3>
<p>The recomended number of samples is by region of analysis. For Switzerland that corresponds to catchment area or river bassin. For an adequate analysis of a single body of water, like a lake, then the number of samples should approach the recommended minimum. However, individual results can be compared directly to baseline values for the region of interest. That is a direct benefit of using the median survey result as opposed to the weighted avarage.</p>
<div class="section" id="extreme-values">
<h4><span class="section-number">7.1.4.1. </span>Extreme values<a class="headerlink" href="#extreme-values" title="Permalink to this headline">¬∂</a></h4>
<p>The exact method to define an extreme value should be evaluated. In this article we used the UE methods because they are applicable for a larger geographic scale. Regional and municipal stakeholders most likely have specific knowledge that can explain extreme results much more efficiently than a model.</p>
</div>
<div class="section" id="quality-people-quality-data">
<h4><span class="section-number">7.1.4.2. </span>Quality people = quality data<a class="headerlink" href="#quality-people-quality-data" title="Permalink to this headline">¬∂</a></h4>
<p>The quality of the data is directly related to the training and support of the surveyors. The identification process is long at first and many objects that are encountered are not part of an <em>average persons</em> day. Encouraging meetings between surveyors and having a core team to assisst in the development and training ensures that the surveys are conducted consistently over time.</p>
</div>
<div class="section" id="objective-criteria-protocols-and-analysis">
<h4><span class="section-number">7.1.4.3. </span>Objective criteria, protocols and analysis<a class="headerlink" href="#objective-criteria-protocols-and-analysis" title="Permalink to this headline">¬∂</a></h4>
<p>The data gathered during IQASL, SLR and the EU data from 2015-2016 are all compatible. This is because they were all based on the same protocol and that protocol <strong>was designed to gather data as accurately as possible given limited reosurces and a large geographic area</strong>. As a result the data is a collection of observations from many people and many countries. That the EU is basing target threshold values on data collected this way is a testament to the process and the people that collected the data.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<p><br></br>
<strong>This project was made possible by the Swiss federal office for the environment.</strong><br></p>
<blockquote>
<div><p>Love what you do. ‚ù§Ô∏è<br></p>
</div></blockquote>
<p><em>roger&#64;hammerdirt.ch</em> pushed the run button on 2021-08-05.<br>
This document originates from https://github.com/hammerdirt-analyst/IQAASL-End-0f-Sampling-2021 all copyrights apply.<br></p>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./end_of_sampling_iqaasl"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="assessing_transport.html" title="previous page"><span class="section-number">6. </span>Transport: an empirical approach</a>
    <a class='right-next' id="next-link" href="alpes_valaisannes.html" title="next page"><span class="section-number">8. </span>Alpes Valaisannes (AV)</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By hammerdirt staff<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>