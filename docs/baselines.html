
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>14. Beach litter baselines</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="15. Key statistical indicators" href="key_indicators.html" />
    <link rel="prev" title="13. Zurichsee" href="zurichsee.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/iqaaslogo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="titlepage.html">
   Identification, quantification and analysis of observable anthropogenic litter along Swiss lake systems
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Executive summary
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Foreword
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="esummary.html">
   Executive summary
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Survey results
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="lakes_rivers.html">
   1. Lakes and rivers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="alpes_valaisannes.html">
   2. The Alps and the Jura
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Survey areas
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="aare_sa.html">
   3. Aare
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linth_sa.html">
   4. Linth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rhone_sa.html">
   5. Rhône
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ticino_sa.html">
   6. Ticino
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lakes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="bielersee.html">
   7. Bielersee
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lac_leman.html">
   8. Lac Léman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="neuenburgersee.html">
   9. Neuenburgersee
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="maggiore_lugano.html">
   10. Maggiore / Lugano
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="thunersee_brienzersee.html">
   11. Thunersee / Brienzersee
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="walensee.html">
   12. Walensee
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zurichsee.html">
   13. Zurichsee
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Understand
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   14. Beach litter baselines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="key_indicators.html">
   15. Key statistical indicators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code_groups.html">
   16. Code groups
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="land_use_correlation.html">
   17. The land use profile
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   18. Bibliografie
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Application
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="reuse_remake.html">
   19. Recycle and remake
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="shared_responsibility.html">
   20. Shared responsibility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="slr_2017.html">
   21. More and less since 2018
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/baselines.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hammerdirt-analyst/IQAASL-End-0f-Sampling-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/hammerdirt-analyst/IQAASL-End-0f-Sampling-2021/issues/new?title=Issue%20on%20page%20%2Fbaselines.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hammerdirt-analyst/IQAASL-End-0f-Sampling-2021/main?urlpath=tree/docs/baselines.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#counting-beach-litter-an-overview">
   14.1. Counting beach litter: an overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#switzerland-2020">
     14.1.1. Switzerland 2020
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collecting-data">
     14.1.2. Collecting data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#defining-the-survey-area">
       14.1.2.1. Defining the survey area
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#counting-objects">
       14.1.2.2. Counting objects
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculating-baselines">
   14.2. Calculating baselines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-data">
     14.2.1. The data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-assessment-metric">
     14.2.2. The assessment metric
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confidence-intervals-cis">
     14.2.3. Confidence intervals (CIs)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bootstrap-methods">
       14.2.3.1. Bootstrap methods:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-bootstrap-cis">
     14.2.4. Comparing bootstrap CIs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#baseline-values">
     14.2.5. Baseline values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#baseline-median-value-of-all-survey-results">
       14.2.5.1. Baseline median value of all survey results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#baseline-median-and-ci-per-survey-area">
       14.2.5.2. Baseline median and CI per survey area
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extreme-values">
   14.3. Extreme values
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-extreme-values">
     14.3.1. Defining extreme values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adjusted-boxplots">
       14.3.1.1. Adjusted boxplots
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modeling">
       14.3.1.2. Modeling
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#method-of-moments">
         14.3.1.2.1. Method of moments
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#maximum-likelihood-estimation">
         14.3.1.2.2. Maximum likelihood estimation
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation">
   14.4. Implementation
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Beach litter baselines</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#counting-beach-litter-an-overview">
   14.1. Counting beach litter: an overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#switzerland-2020">
     14.1.1. Switzerland 2020
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collecting-data">
     14.1.2. Collecting data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#defining-the-survey-area">
       14.1.2.1. Defining the survey area
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#counting-objects">
       14.1.2.2. Counting objects
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculating-baselines">
   14.2. Calculating baselines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-data">
     14.2.1. The data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-assessment-metric">
     14.2.2. The assessment metric
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confidence-intervals-cis">
     14.2.3. Confidence intervals (CIs)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bootstrap-methods">
       14.2.3.1. Bootstrap methods:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-bootstrap-cis">
     14.2.4. Comparing bootstrap CIs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#baseline-values">
     14.2.5. Baseline values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#baseline-median-value-of-all-survey-results">
       14.2.5.1. Baseline median value of all survey results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#baseline-median-and-ci-per-survey-area">
       14.2.5.2. Baseline median and CI per survey area
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extreme-values">
   14.3. Extreme values
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-extreme-values">
     14.3.1. Defining extreme values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adjusted-boxplots">
       14.3.1.1. Adjusted boxplots
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modeling">
       14.3.1.2. Modeling
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#method-of-moments">
         14.3.1.2.1. Method of moments
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#maximum-likelihood-estimation">
         14.3.1.2.2. Maximum likelihood estimation
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation">
   14.4. Implementation
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a report using the data from IQAASL.</span>
<span class="c1"># IQAASL was a project funded by the Swiss Confederation</span>
<span class="c1"># It produces a summary of litter survey results for a defined region.</span>
<span class="c1"># These charts serve as the models for the development of plagespropres.ch</span>
<span class="c1"># The data is gathered by volunteers.</span>
<span class="c1"># Please remember all copyrights apply, please give credit when applicable</span>
<span class="c1"># The repo is maintained by the community effective January 01, 2022</span>
<span class="c1"># There is ample opportunity to contribute, learn and teach</span>
<span class="c1"># contact dev@hammerdirt.ch</span>

<span class="c1"># Dies ist ein Bericht, der die Daten von IQAASL verwendet.</span>
<span class="c1"># IQAASL war ein von der Schweizerischen Eidgenossenschaft finanziertes Projekt.</span>
<span class="c1"># Es erstellt eine Zusammenfassung der Ergebnisse der Littering-Umfrage für eine bestimmte Region.</span>
<span class="c1"># Diese Grafiken dienten als Vorlage für die Entwicklung von plagespropres.ch.</span>
<span class="c1"># Die Daten werden von Freiwilligen gesammelt.</span>
<span class="c1"># Bitte denken Sie daran, dass alle Copyrights gelten, bitte geben Sie den Namen an, wenn zutreffend.</span>
<span class="c1"># Das Repo wird ab dem 01. Januar 2022 von der Community gepflegt.</span>
<span class="c1"># Es gibt reichlich Gelegenheit, etwas beizutragen, zu lernen und zu lehren.</span>
<span class="c1"># Kontakt dev@hammerdirt.ch</span>

<span class="c1"># Il s&#39;agit d&#39;un rapport utilisant les données de IQAASL.</span>
<span class="c1"># IQAASL était un projet financé par la Confédération suisse.</span>
<span class="c1"># Il produit un résumé des résultats de l&#39;enquête sur les déchets sauvages pour une région définie.</span>
<span class="c1"># Ces tableaux ont servi de modèles pour le développement de plagespropres.ch</span>
<span class="c1"># Les données sont recueillies par des bénévoles.</span>
<span class="c1"># N&#39;oubliez pas que tous les droits d&#39;auteur s&#39;appliquent, veuillez indiquer le crédit lorsque cela est possible.</span>
<span class="c1"># Le dépôt est maintenu par la communauté à partir du 1er janvier 2022.</span>
<span class="c1"># Il y a de nombreuses possibilités de contribuer, d&#39;apprendre et d&#39;enseigner.</span>
<span class="c1"># contact dev@hammerdirt.ch</span>

<span class="c1"># sys, file and nav packages:</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>

<span class="c1"># math packages:</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.distributions.empirical_distribution</span> <span class="kn">import</span> <span class="n">ECDF</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">medcouple</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">newton</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">digamma</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># charting:</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># home brew utitilties</span>
<span class="kn">import</span> <span class="nn">resources.chart_kwargs</span> <span class="k">as</span> <span class="nn">ck</span>
<span class="kn">import</span> <span class="nn">resources.sr_ut</span> <span class="k">as</span> <span class="nn">sut</span>

<span class="c1"># images and display</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">PILImage</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>

<span class="c1"># set some parameters:</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;2020-03-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span><span class="s1">&#39;2021-05-31&#39;</span>

<span class="c1"># name of the output folder:</span>
<span class="n">name_of_project</span> <span class="o">=</span> <span class="s1">&#39;threshold_values&#39;</span>

<span class="c1"># the scale for pieces per meter and the column and chart label for the units</span>
<span class="n">reporting_unit</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">unit_label</span> <span class="o">=</span> <span class="s1">&#39;p/100m&#39;</span>

<span class="c1"># get your data:</span>
<span class="n">survey_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;resources/checked_sdata_eos_2020_21.csv&#39;</span><span class="p">)</span>
<span class="n">dfBeaches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/beaches_with_land_use_rates.csv&quot;</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/codes_with_group_names_2015.csv&quot;</span><span class="p">)</span>
<span class="n">dfDims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/corrected_dims.csv&quot;</span><span class="p">)</span>

<span class="c1"># set the index of the beach data to location slug</span>
<span class="n">dfBeaches</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># index the code data</span>
<span class="n">dfCodes</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># these descriptions need to be shortened for display</span>
<span class="n">codes_to_change</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;G74&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Insulation foams&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G940&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Foamed EVA for crafts and sports&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G96&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Sanitary-pads/tampons, applicators&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G178&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Metal bottle caps and lids&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G82&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Expanded foams 2.5cm - 50cm&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G81&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Expanded foams .5cm - 2.5cm&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G117&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Expanded foams &lt; 5mm&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G75&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic/foamed polystyrene 0 - 2.5cm&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G76&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic/foamed polystyrene 2.5cm - 50cm&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G24&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic lid rings&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G33&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Lids for togo drinks plastic&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G3&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic bags, carier bags&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G204&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Bricks, pipes not plastic&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G904&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Plastic fireworks&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;G211&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Swabs, bandaging, medical&quot;</span><span class="p">],</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">codes_to_change</span><span class="p">:</span>
    <span class="n">dfCodes</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">shorten_the_value</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfCodes</span><span class="p">)</span>
    
<span class="c1"># make a map to the code descriptions</span>
<span class="n">code_description_map</span> <span class="o">=</span> <span class="n">dfCodes</span><span class="o">.</span><span class="n">description</span>

<span class="c1"># make a map to the code descriptions</span>
<span class="n">code_material_map</span> <span class="o">=</span> <span class="n">dfCodes</span><span class="o">.</span><span class="n">material</span>
</pre></div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="beach-litter-baselines">
<span id="threshhold"></span><h1><span class="section-number">14. </span>Beach litter baselines<a class="headerlink" href="#beach-litter-baselines" title="Permalink to this headline">¶</a></h1>
<p><a href="baselines_de.html"> Deutsch </a></p>
<p>Baseline values (BVs), sometimes referred to as benchmarks, are the quantities or values that are used to define a situation statistically. The BVs refer to a set of data that has both temporal and geographical limits, also known as a reference point or baseline period. BVs are the quantities against which progress is measured. In this regard, BVs are intimately linked to the data and the methods used to collect it.</p>
<div class="section" id="counting-beach-litter-an-overview">
<h2><span class="section-number">14.1. </span>Counting beach litter: an overview<a class="headerlink" href="#counting-beach-litter-an-overview" title="Permalink to this headline">¶</a></h2>
<p>The first international guide to collecting beach-litter data was published in 2008 by the United Nations Environment Program (UNEP) and Intergovernmental Oceanographic Commission (IOC) <span id="id1">[<a class="reference internal" href="references.html#id48" title="Cheshire et all. Unep/ioc guidelines on survey and monitoring of marine litter. UNEP Regional Seas Reports and Studies, 2009.">eall09</a>]</span>. Based on the accumulated work of many scientists, this method was reproduced by the OSPAR Commission in 2010 <span id="id2">[<a class="reference internal" href="references.html#id43" title="OSPAR. Beach litter - abundance, composition and trends. D10 - Marine Litter, 2017.">OSP17</a>]</span>, and in 2013 the EU released Guidance on Monitoring of Marine Litter in European Seas (the guide) <span id="id3">[<a class="reference internal" href="references.html#id41" title="George Hanke. Guidance on monitoring of marine litter in european seas. Joint Research Centre of the European Commission, 2013. URL: https://indicit-europa.eu/cms/wp-content/uploads/2017/05/guidance_monitoring_marine_litter_2013.pdf.">Han13</a>]</span>. Switzerland is a member of OSPAR and has over 1,000 samples using the methods described in <em>the guide</em>.</p>
<p><em>The guide</em> was followed by Riverine Litter Monitoring - Options and Recommendations in 2016 <span id="id4">[<a class="reference internal" href="references.html#id45" title="Georg Hanke, Daniel González Fernández, Tweehuysen, Bellert, Holzhauer, Andreja Palatinus, Hohenblum, and L. Oosterbaan. Riverine litter monitoring - options and recommendations. publications Office of the European Union, 02 2017. doi:10.2788/461233.">HGFT+17</a>]</span>, reflecting the mounting evidence that rivers are important sources of household waste in coastal regions. By that time the initial beach litter surveillance project on Lake Geneva had run its course and preparations were on the way for a yearlong national project in Switzerland initiated by STOPPP and supported by WWF volunteers, see <a class="reference internal" href="slr_2017.html#slr-iqaasl"><span class="std std-ref"><em>More and less trash since 2017</em></span></a>.</p>
<p>In 2019 the Joint Research Centre (JRC) released an Analysis of a pan-European 2012-2016 beach litter dataset, a technical document that detailed the methods and different scenarios for calculating baseline values from beach litter data. Of particular interest to the JRC was the robustness of methods to extreme values and transparency of the calculation method. <span id="id5">[<a class="reference internal" href="references.html#id42" title="van Loon W. Hanke G., Walvoort D. Eu marine beach litter baselines. Publications Office of the European Union, 2019. doi:10.2760/16903.">HG19</a>]</span></p>
<p>Finally, in September 2020 the EU established baseline and target values based on the data collected from 2015-2016. The target values relate to the Good Environmental Status of marine waters described by the Marine Strategy Framework Directive (MSFD) and the baselines were calculated using the methods described in the 2019 publication. <span id="id6">[<a class="reference internal" href="references.html#id44" title="Fleet D. Van Loon W., Hanke G. A european threshold value and assessment method for macro litter on coastlines. Publications Office of the European Union, 2020.">VLW20</a>]</span></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/baselines_2_0.png" src="_images/baselines_2_0.png" />
</div>
</div>
<p><em><strong>Above:</strong> Counting beach litter on Zurichsee. Richterswill May 18, 2020 3.49 pieces of trash per meter.</em></p>
<div class="section" id="switzerland-2020">
<h3><span class="section-number">14.1.1. </span>Switzerland 2020<a class="headerlink" href="#switzerland-2020" title="Permalink to this headline">¶</a></h3>
<p>The IQAASL project began in April 2020, locations throughout the defined survey areas were sampled in 2017, 2015 or newly established. Similar to survey results in the marine environment beach-litter-data in Switzerland is highly variable. With values ranging from zero to thousands of objects and fragments within 100m of river or lake shoreline.</p>
</div>
<div class="section" id="collecting-data">
<h3><span class="section-number">14.1.2. </span>Collecting data<a class="headerlink" href="#collecting-data" title="Permalink to this headline">¶</a></h3>
<p><em>The guide</em> is the reference for this project. However, the geography of Switzerland does not include long stretches of homogeneous coastline. Therefore, certain recommendations must be put in the context of the local topography.</p>
<ol class="simple">
<li><p>The recommended length remains 100m, depending on the region this may not be possible.</p></li>
</ol>
<div class="section" id="defining-the-survey-area">
<h4><span class="section-number">14.1.2.1. </span>Defining the survey area<a class="headerlink" href="#defining-the-survey-area" title="Permalink to this headline">¶</a></h4>
<p>A survey area is defined by the GPS point and the survey dimensions recorded. The minimum width is the distance between the waters edge and the strandline. In some cases the strandline and the back of the beach may be the same. For more information on how the survey areas are measured see <a class="reference internal" href="land_use_correlation.html#luseprofile"><span class="std std-ref">The land use profile</span></a>.</p>
<p><em><strong>Below:</strong> Different sampling environments</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/baselines_7_0.png" src="_images/baselines_7_0.png" />
</div>
</div>
<p>The length and width of the survey area is measured at each survey. Thus, the number of items can be reported in a standard unit indifferent of the survey locations. In this report the standard reporting unit recommended by the EU is used: <em>pieces of litter per 100 meters</em>.</p>
</div>
<div class="section" id="counting-objects">
<h4><span class="section-number">14.1.2.2. </span>Counting objects<a class="headerlink" href="#counting-objects" title="Permalink to this headline">¶</a></h4>
<p>All visible objects within a survey area are collected, classified and counted. Total material and plastic weights are also recorded. Items are classified by <a class="reference internal" href="code_groups.html#codegroups"><span class="std std-ref">code definitions</span></a> based on a master list of codes in <em>The Guide</em>. Specific objects that are of local interest have been added under G9xx and G7xx.</p>
<p><em><strong>Below:</strong> Counting and classifying a sample. The objects are sorted and counted after collection. The original count is maintained in a notebook and the data is entered into the application, <a class="reference external" href="https://www.plagespropres.ch/"> plages-propres </a> at the convenience of the surveyor.</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/baselines_10_0.png" src="_images/baselines_10_0.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="calculating-baselines">
<h2><span class="section-number">14.2. </span>Calculating baselines<a class="headerlink" href="#calculating-baselines" title="Permalink to this headline">¶</a></h2>
<p>The methods described in sections 3 and 4 of <em>A European Threshold Value and Assessment Method for Macro Litter on Coastlines</em> and sections 6, 7 and 8 from <em>Analysis of a pan-European 2012-2016 beach litter data set</em> are applied to the beach litter survey results from April 2020 to May 2021.</p>
<p>The different options for calculating baselines, determining confidence intervals and identifying extreme values are explained and examples are given.</p>
<p><strong>Assumptions:</strong></p>
<ul class="simple">
<li><p>The more litter on the ground, the more a person is likely to find</p></li>
<li><p><strong>The survey results represent the minimum amount of litter at that site</strong></p></li>
<li><p>For each survey: finding one item does not effect the chance of finding another</p></li>
</ul>
<div class="section" id="the-data">
<h3><span class="section-number">14.2.1. </span>The data<a class="headerlink" href="#the-data" title="Permalink to this headline">¶</a></h3>
<p>Only surveys with a length greater than ten meters and are included in the baseline calculation. The following objects were excluded:</p>
<ol class="simple">
<li><p>Objects less than 2.5cm</p></li>
<li><p>Paraffin, wax, oil and other pollutants</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the final survey data set here:</span>
<span class="n">a_data</span> <span class="o">=</span> <span class="n">survey_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">a_data</span> <span class="o">=</span> <span class="n">a_data</span><span class="p">[</span><span class="n">a_data</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">!=</span> <span class="s1">&#39;les-alpes&#39;</span><span class="p">]</span>

<span class="c1"># make a loc_date column from the survey data</span>
<span class="c1"># before converting to timestamp</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">a_data</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>

<span class="c1"># convert string dates from .csv to timestamp</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># slice by start - end date</span>
<span class="n">a_data</span> <span class="o">=</span> <span class="n">a_data</span><span class="p">[(</span><span class="n">a_data</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">)]</span>

<span class="c1"># combine lugano and maggiore</span>
<span class="c1"># if the river bassin name does not equal tresa leave it, else change it to ticino</span>
<span class="n">a_data</span><span class="p">[</span><span class="s1">&#39;river_bassin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">river_bassin</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">!=</span> <span class="s1">&#39;tresa&#39;</span><span class="p">,</span> <span class="s1">&#39;ticino&#39;</span> <span class="p">)</span>

<span class="c1"># assign the reporting value</span>
<span class="n">a_data</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">pcs_m</span> <span class="o">*</span> <span class="n">reporting_unit</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># save the data before aggregating to test</span>
<span class="n">before_agg</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># !! Remove the objects less than 2.5cm and chemicals !!</span>
<span class="n">codes_todrop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;G81&#39;</span><span class="p">,</span> <span class="s1">&#39;G78&#39;</span><span class="p">,</span> <span class="s1">&#39;G212&#39;</span><span class="p">,</span> <span class="s1">&#39;G213&#39;</span><span class="p">,</span> <span class="s1">&#39;G214&#39;</span><span class="p">]</span>
<span class="n">a_data</span> <span class="o">=</span> <span class="n">a_data</span><span class="p">[</span><span class="o">~</span><span class="n">a_data</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">codes_todrop</span><span class="p">)]</span>

<span class="c1"># use the code groups to get rid of all objects less than 5mm</span>
<span class="n">a_data</span> <span class="o">=</span> <span class="n">a_data</span><span class="p">[</span><span class="n">a_data</span><span class="o">.</span><span class="n">groupname</span> <span class="o">!=</span>  <span class="s1">&#39;micro plastics (&lt; 5mm)&#39;</span><span class="p">]</span>

<span class="c1"># match records to survey data</span>
<span class="n">fd_dims</span><span class="o">=</span> <span class="n">dfDims</span><span class="p">[(</span><span class="n">dfDims</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">a_data</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dfDims</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dfDims</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># make a loc_date column and get the unique values</span>
<span class="n">fd_dims</span><span class="p">[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fd_dims</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">fd_dims</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>

<span class="c1"># map the survey area name to the dims data record</span>
<span class="n">a_map</span> <span class="o">=</span> <span class="n">fd_dims</span><span class="p">[[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;loc_date&#39;</span><span class="p">)</span>
<span class="n">l_map</span> <span class="o">=</span> <span class="n">fd_dims</span><span class="p">[[</span><span class="s1">&#39;loc_date&#39;</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;loc_date&#39;</span><span class="p">)</span>

<span class="c1"># map length and area from dims to survey data</span>
<span class="k">for</span> <span class="n">a_survey</span> <span class="ow">in</span> <span class="n">fd_dims</span><span class="o">.</span><span class="n">loc_date</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">a_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a_data</span><span class="o">.</span><span class="n">loc_date</span> <span class="o">==</span> <span class="n">a_survey</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_survey</span><span class="p">],</span> <span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a_data</span><span class="o">.</span><span class="n">loc_date</span> <span class="o">==</span> <span class="n">a_survey</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">a_survey</span><span class="p">],</span> <span class="s1">&#39;area&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># exclude surveys 10 meters or less</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">a_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">a_data</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># this is a common aggregation</span>
<span class="n">agg_pcs_quantity</span> <span class="o">=</span> <span class="p">{</span><span class="n">unit_label</span><span class="p">:</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">:</span><span class="s1">&#39;sum&#39;</span><span class="p">}</span>

<span class="c1"># survey totals by location</span>
<span class="n">dt_all</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;loc_date&#39;</span><span class="p">,</span><span class="s1">&#39;location&#39;</span><span class="p">,</span><span class="s1">&#39;river_bassin&#39;</span><span class="p">,</span> <span class="s1">&#39;water_name_slug&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_pcs_quantity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Below:</strong> Survey results and summary statistics: samples greater than 10m and excluding objects less than 2.5cm and chemicals, n=372</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># palettes and labels</span>
<span class="n">bassin_pallette</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rhone&#39;</span><span class="p">:</span><span class="s1">&#39;dimgray&#39;</span><span class="p">,</span> <span class="s1">&#39;aare&#39;</span><span class="p">:</span><span class="s1">&#39;salmon&#39;</span><span class="p">,</span> <span class="s1">&#39;linth&#39;</span><span class="p">:</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="s1">&#39;ticino&#39;</span><span class="p">:</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="s1">&#39;reuss&#39;</span><span class="p">:</span><span class="s1">&#39;purple&#39;</span><span class="p">}</span>
<span class="n">comp_labels</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;linth&quot;</span><span class="p">:</span><span class="s2">&quot;Linth/Limmat&quot;</span><span class="p">,</span> <span class="s2">&quot;rhone&quot;</span><span class="p">:</span><span class="s2">&quot;Rhône&quot;</span><span class="p">,</span> <span class="s1">&#39;aare&#39;</span><span class="p">:</span><span class="s2">&quot;Aare&quot;</span><span class="p">,</span> <span class="s2">&quot;ticino&quot;</span><span class="p">:</span><span class="s2">&quot;Ticino/Cerisio&quot;</span><span class="p">,</span> <span class="s2">&quot;reuss&quot;</span><span class="p">:</span><span class="s2">&quot;Reuss&quot;</span><span class="p">}</span>
<span class="n">comp_palette</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Linth/Limmat&quot;</span><span class="p">:</span><span class="s2">&quot;dimgray&quot;</span><span class="p">,</span> <span class="s2">&quot;Rhône&quot;</span><span class="p">:</span><span class="s2">&quot;tan&quot;</span><span class="p">,</span> <span class="s2">&quot;Aare&quot;</span><span class="p">:</span><span class="s2">&quot;salmon&quot;</span><span class="p">,</span> <span class="s2">&quot;Ticino/Cerisio&quot;</span><span class="p">:</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="s2">&quot;Reuss&quot;</span><span class="p">:</span><span class="s2">&quot;purple&quot;</span><span class="p">}</span>

<span class="c1"># months locator, can be confusing</span>
<span class="c1"># https://matplotlib.org/stable/api/dates_api.html</span>
<span class="n">months</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">MonthLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">months_fmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DayLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># sns.set_style(&#39;whitegrid&#39;)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="n">axtwo</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:])</span>

<span class="c1"># scale the chart as needed to accomodate for extreme values</span>
<span class="n">scale_back</span> <span class="o">=</span> <span class="mi">98</span>

<span class="c1"># the results gets applied to the y_limit function in the chart</span>
<span class="n">the_90th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">],</span> <span class="n">scale_back</span><span class="p">)</span>

<span class="c1"># the survey totals</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dt_all</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;river_bassin&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">bassin_pallette</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># set params on ax:</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">the_90th</span> <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">unit_label</span><span class="p">,</span> <span class="o">**</span><span class="n">ck</span><span class="o">.</span><span class="n">xlab_k14</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">months_fmt</span><span class="p">)</span>

<span class="c1"># axtwo</span>
<span class="n">a_color</span> <span class="o">=</span> <span class="s2">&quot;dodgerblue&quot;</span>

<span class="c1"># summarize the survey totals and format for printing</span>
<span class="n">table_data</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">table_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">table_data</span> <span class="o">=</span> <span class="n">table_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">table_data</span> <span class="o">=</span> <span class="n">table_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># make a 2d array</span>
<span class="n">t_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">table_data</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

<span class="n">sut</span><span class="o">.</span><span class="n">hide_spines_ticks_grids</span><span class="p">(</span><span class="n">axtwo</span><span class="p">)</span>

<span class="n">the_first_table_data</span> <span class="o">=</span> <span class="n">axtwo</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">t_data</span><span class="p">,</span>  <span class="n">colLabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Stat&quot;</span><span class="p">,</span> <span class="n">unit_label</span><span class="p">],</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">a_summary_table_one</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">make_a_summary_table</span><span class="p">(</span><span class="n">the_first_table_data</span><span class="p">,</span><span class="n">t_data</span><span class="p">,[</span><span class="s2">&quot;Stat&quot;</span><span class="p">,</span> <span class="n">unit_label</span><span class="p">],</span> <span class="n">a_color</span><span class="p">,</span> <span class="n">s_et_bottom_row</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">a_summary_table_one</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="n">a_summary_table_one</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

<span class="n">axtwo</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/baselines_15_0.png" src="_images/baselines_15_0.png" />
</div>
</div>
<p><em><strong>Below:</strong> Distribution of surveys and percentile ranking values: all surveys. Note the mean (341p/100m) is greater than the median (180p/100m).</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># percentile rankings  1, 5, 10, 15, 20</span>
<span class="n">these_vals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">.01</span><span class="p">,</span><span class="mf">.05</span><span class="p">,</span><span class="mf">.10</span><span class="p">,</span><span class="mf">.15</span><span class="p">,</span><span class="mf">.20</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.9</span> <span class="p">]:</span>
    <span class="n">a_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">element</span><span class="p">)</span>
    <span class="n">these_vals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">F</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">element</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span><span class="sa">F</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">a_val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
    


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="n">axtwo</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dt_all</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">sut</span><span class="o">.</span><span class="n">hide_spines_ticks_grids</span><span class="p">(</span><span class="n">axtwo</span><span class="p">)</span>

<span class="n">the_first_table_data</span> <span class="o">=</span> <span class="n">axtwo</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">these_vals</span><span class="p">,</span>  <span class="n">colLabels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ranking&#39;</span><span class="p">,</span> <span class="n">unit_label</span><span class="p">),</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">a_summary_table_one</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">make_a_summary_table</span><span class="p">(</span><span class="n">the_first_table_data</span><span class="p">,</span><span class="n">these_vals</span><span class="p">,(</span><span class="s1">&#39;ranking&#39;</span><span class="p">,</span> <span class="n">unit_label</span><span class="p">),</span> <span class="n">a_color</span><span class="p">,</span> <span class="n">s_et_bottom_row</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">a_summary_table_one</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot;ranking&quot;</span><span class="p">)</span>
<span class="n">a_summary_table_one</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

<span class="n">axtwo</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/baselines_17_0.png" src="_images/baselines_17_0.png" />
</div>
</div>
</div>
<div class="section" id="the-assessment-metric">
<h3><span class="section-number">14.2.2. </span>The assessment metric<a class="headerlink" href="#the-assessment-metric" title="Permalink to this headline">¶</a></h3>
<p>Calculating baseline values requires the aggregation of survey results at different temporal and geographic scales. The best method is:</p>
<ul class="simple">
<li><p>Robust with respect to outliers</p></li>
<li><p>Simple to calculate</p></li>
<li><p>Widely understood</p></li>
</ul>
<p>The two most common test statistics used to compare data are the mean and the median. The mean is the best predictor of central tendency if the data are  <span class="math notranslate nohighlight">\(\approxeq\)</span> normally distributed. However, beach litter survey results have a high variance relative to the mean. Methods can be applied to the data to reduce the effects of high variance when calculating the mean:</p>
<ol class="simple">
<li><p><em>trimmed mean</em>: removes a small, designated percentage of the largest and smallest values before calculating the mean</p></li>
<li><p><em>tri mean</em>: the weighted average of the median and upper and lower quartiles, <span class="math notranslate nohighlight">\((Q1 + 2Q2 + Q3)/4\)</span></p></li>
<li><p><em>mid hinge:</em> <span class="math notranslate nohighlight">\((Q1 + Q3)/2\)</span></p></li>
</ol>
<p>While effective at reducing the effects of the outliers, the previous methods are not as simple to calculate as the mean or the median and therefore the significance of the results may not be well understood.</p>
<p>The median (50th percentile) is an equally good predictor of the central tendency but is much less effected by extreme values compared to the mean. The more a set of data approaches a normal distribution the closer the median and mean approach. The median and the accompanying percentile functions are available on most spreadsheet applications.</p>
<p>For the reasons cited previously, <strong>the median value of a minimum number of samples collected from a survey area during one sampling period is considered statistically suitable for beach litter assessments</strong>. For the marine environment the *minimum number of samples is 40 per subregion and the <strong>sampling period is 6 years</strong>. <span id="id7">[<a class="reference internal" href="references.html#id42" title="van Loon W. Hanke G., Walvoort D. Eu marine beach litter baselines. Publications Office of the European Union, 2019. doi:10.2760/16903.">HG19</a>]</span></p>
</div>
<div class="section" id="confidence-intervals-cis">
<h3><span class="section-number">14.2.3. </span>Confidence intervals (CIs)<a class="headerlink" href="#confidence-intervals-cis" title="Permalink to this headline">¶</a></h3>
<p>Confidence intervals (CIs) help communicate the uncertainty of beach-litter survey results with regards to any general conclusions that may be drawn about the abundance of beach litter within a region. The CI gives the lower and higher range of the estimate of the test statistic given the sample data.</p>
<p>The best way to mitigate uncertainty is to have the appropriate number of samples for the region or area of interest. However, beach litter surveys have a high variance and any estimate of an aggregate value should reflect that variance or uncertainty. CIs provide a probable range of values given the uncertainty/variance of the data.<span id="id8">[<a class="reference internal" href="references.html#id42" title="van Loon W. Hanke G., Walvoort D. Eu marine beach litter baselines. Publications Office of the European Union, 2019. doi:10.2760/16903.">HG19</a>]</span></p>
<p>In this method data is NOT excluded from the baseline calculations and confidence intervals:</p>
<blockquote>
<div><p>It was agreed to leave the extreme results in the dataset, while highlighting the need to check to verify extreme data case by case and to apply the median for calculating of averages. This allows the use of all data while not skewing results through single extraordinary high litter count surveys. <span id="id9">[<a class="reference internal" href="references.html#id44" title="Fleet D. Van Loon W., Hanke G. A european threshold value and assessment method for macro litter on coastlines. Publications Office of the European Union, 2020.">VLW20</a>]</span></p>
</div></blockquote>
<div class="section" id="bootstrap-methods">
<h4><span class="section-number">14.2.3.1. </span>Bootstrap methods:<a class="headerlink" href="#bootstrap-methods" title="Permalink to this headline">¶</a></h4>
<p>Bootstrapping is a resampling method that uses random sampling with replacement to repeat or simulate the sampling process. Bootstrapping permits the estimation of the sampling distribution of sample statistics using random sampling methods. <span id="id10">[<a class="reference internal" href="references.html#id29" title="Wikepedia. Bootstrapping. URL: https://en.wikipedia.org/wiki/Bootstrapping_(statistics).">Wika</a>]</span> <span id="id11">[<a class="reference internal" href="references.html#id18" title="Kwanghee Jung, Jaehoon Lee, Vibhuti Gupta, and Gyeongcheol Cho. Comparison of bootstrap confidence interval methods for gsca using a monte carlo simulation. Frontiers in Psychology, 10:2215, 2019. URL: https://www.frontiersin.org/article/10.3389/fpsyg.2019.02215, doi:10.3389/fpsyg.2019.02215.">JLGC19</a>]</span> <span id="id12">[<a class="reference internal" href="references.html#id26" title="Stackexchange. Is it true that the percentile bootstrap should never be used? 2021. URL: https://stats.stackexchange.com/questions/355781/is-it-true-that-the-percentile-bootstrap-should-never-be-used.">Sta21b</a>]</span></p>
<p>Bootstrap methods are used to calculate the CIs of the test statistics, by repeating the sampling process and evaluating the median at each repetition. The range of values described by the middle 95% of the bootstrap results is the CI for the observed test statistic.</p>
<p>There are several computational methods to choose from such as percentile, BCa, and Student’s t. For this example, two methods were tested:</p>
<ol class="simple">
<li><p>Percentile bootstrap</p></li>
<li><p>Bias-corrected accelerated bootstrap confidence interval (BCa)</p></li>
</ol>
<p>The percentile method does not account for the shape of the underlying distribution, and this can lead to confidence intervals that do not match the data. The BCa corrects that. The implementation of these methods is straight forward using the previously cited packages. <span id="id13">[<a class="reference internal" href="references.html#id27" title="Bradley Efron. Better bootstrap confidence intervals. Journal of the American Statistical Association, 82(397):171-185, 1987. URL: https://www.tandfonline.com/doi/abs/10.1080/01621459.1987.10478410, arXiv:https://www.tandfonline.com/doi/pdf/10.1080/01621459.1987.10478410, doi:10.1080/01621459.1987.10478410.">Efr87</a>]</span> <span id="id14">[<a class="reference internal" href="references.html#id28" title="Erik drysdale. Implementing the bias-corrected and accelerated bootstrap in python. 2020. URL: https://www.erikdrysdale.com/bca_python/.">dry20</a>]</span> <span id="id15">[<a class="reference internal" href="references.html#id31" title="Justin Bois. Introduction to data analysis in the biological sciences. 2019. URL: http://bebi103.caltech.edu.s3-website-us-east-1.amazonaws.com/2019a/content/index.html#.">Boi19</a>]</span></p>
</div>
</div>
<div class="section" id="comparing-bootstrap-cis">
<h3><span class="section-number">14.2.4. </span>Comparing bootstrap CIs<a class="headerlink" href="#comparing-bootstrap-cis" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this code was modified from this source:</span>
<span class="c1"># http://bebi103.caltech.edu.s3-website-us-east-1.amazonaws.com/2019a/content/recitations/bootstrapping.html</span>
<span class="c1"># if you want to get the confidence interval around another point estimate use np.percentile</span>
<span class="c1"># and add the percentile value as a parameter</span>

<span class="k">def</span> <span class="nf">draw_bs_sample</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draw a bootstrap sample from a 1D data set.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">compute_jackknife_reps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns jackknife resampled replicates for the given data and statistical function&#39;&#39;&#39;</span>
    <span class="c1"># Set up empty array to store jackknife replicates</span>
    <span class="n">jack_reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="c1"># For each observation in the dataset, compute the statistical function on the sample</span>
    <span class="c1"># with that observation removed</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">jack_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_param</span><span class="p">:</span>
            <span class="n">jack_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">jack_sample</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jack_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">jack_sample</span><span class="p">,</span> <span class="n">stat_param</span><span class="p">)</span>          
        
    <span class="k">return</span> <span class="n">jack_reps</span>


<span class="k">def</span> <span class="nf">compute_a</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the acceleration constant a&#39;&#39;&#39;</span>

    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">x</span><span class="o">**-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span> <span class="p">(</span><span class="n">mean</span><span class="o">**-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span><span class="o">**</span><span class="mi">3</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)])</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">x</span><span class="o">**-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">mean</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">c</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">bootstrap_replicates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Computes n_reps number of bootstrap replicates for given data and statistical function&#39;&#39;&#39;</span>
    <span class="n">boot_reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_reps</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_reps</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_param</span><span class="p">:</span>
            <span class="n">boot_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">draw_bs_sample</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boot_reps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">draw_bs_sample</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">stat_param</span><span class="p">)</span>     
        
    <span class="k">return</span> <span class="n">boot_reps</span>


<span class="k">def</span> <span class="nf">compute_z0</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">boot_reps</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Computes z0 for given data and statistical function&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_param</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">stat_param</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">boot_reps</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">boot_reps</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">compute_bca_ci</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">alpha_level</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns BCa confidence interval for given data at given alpha level&#39;&#39;&#39;</span>
    <span class="c1"># Compute bootstrap and jackknife replicates</span>
    <span class="n">boot_reps</span> <span class="o">=</span> <span class="n">bootstrap_replicates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_reps</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">statfunction</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="n">stat_param</span><span class="p">)</span>
    <span class="n">jack_reps</span> <span class="o">=</span> <span class="n">compute_jackknife_reps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">statfunction</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="n">stat_param</span><span class="p">)</span>

    <span class="c1"># Compute a and z0</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">compute_a</span><span class="p">(</span><span class="n">jack_reps</span><span class="p">)</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">compute_z0</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">boot_reps</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">statfunction</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="n">stat_param</span><span class="p">)</span>

    <span class="c1"># Compute confidence interval indices</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha_level</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">alpha_level</span><span class="o">/</span><span class="mf">2.</span><span class="p">])</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">+</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">alphas</span><span class="o">.</span><span class="n">shape</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span><span class="o">*</span><span class="n">z0</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    <span class="n">avals</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">z0</span> <span class="o">+</span> <span class="n">zs</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">zs</span><span class="p">))</span>
    <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">boot_reps</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">avals</span><span class="p">)</span>
    <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>

    <span class="c1"># Compute confidence interval</span>
    <span class="n">boot_reps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">boot_reps</span><span class="p">)</span>
    <span class="n">ci_low</span> <span class="o">=</span> <span class="n">boot_reps</span><span class="p">[</span><span class="n">ints</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">ci_high</span> <span class="o">=</span> <span class="n">boot_reps</span><span class="p">[</span><span class="n">ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_high</span><span class="p">)</span>

<span class="n">quantiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.9</span><span class="p">]</span>
<span class="n">q_vals</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">quantiles</span><span class="p">}</span>

<span class="n">the_bcas</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">a_rank</span> <span class="ow">in</span> <span class="n">quantiles</span><span class="p">:</span>
    <span class="n">an_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a_rank</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">a_result</span> <span class="o">=</span> <span class="n">compute_bca_ci</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="mf">.05</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="n">an_int</span><span class="p">)</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">an_int</span><span class="p">)</span>
    <span class="n">the_bcas</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">F</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">a_rank</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:{</span><span class="s1">&#39;2.5</span><span class="si">% c</span><span class="s1">i&#39;</span><span class="p">:</span><span class="n">a_result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="n">observed</span><span class="p">,</span> <span class="s1">&#39;97.5</span><span class="si">% c</span><span class="s1">i&#39;</span><span class="p">:</span> <span class="n">a_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]}})</span>


<span class="n">bca_cis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">the_bcas</span><span class="p">)</span>
<span class="n">bcas</span> <span class="o">=</span> <span class="n">bca_cis</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">bcas</span><span class="p">[[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">,</span> <span class="s1">&#39;90&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">bcas</span><span class="p">[[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">,</span> <span class="s1">&#39;90&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">bcas</span><span class="p">[</span><span class="s1">&#39;b-method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BCa&#39;</span>

<span class="c1"># bootstrap percentile confidence intervals</span>
<span class="c1"># resample the survey totals for n times to help</span>
<span class="c1"># define the range of the sampling statistic</span>
<span class="c1"># the number of reps</span>
<span class="n">n</span><span class="o">=</span><span class="mi">5000</span>

<span class="c1"># keep the observed values</span>
<span class="n">observed_median</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">observed_tenth</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">.15</span><span class="p">)</span>

<span class="n">the_cis</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">a_rank</span> <span class="ow">in</span> <span class="n">quantiles</span><span class="p">:</span>
    <span class="c1"># for the median</span>
    <span class="n">sim_ptile</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># for the tenth percentile</span>
    <span class="n">sim_ten</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">less</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dt_all</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
        <span class="n">a_ptile</span> <span class="o">=</span> <span class="n">less</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">a_rank</span><span class="p">)</span>
        <span class="n">sim_ptile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_ptile</span><span class="p">)</span>
    <span class="c1"># get the upper and lower range of the test statistic disrtribution:</span>
    <span class="n">a_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_ptile</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">a_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_ptile</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>
    
    <span class="c1"># add the observed value and update the dict</span>
    <span class="n">the_cis</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">F</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">a_rank</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:{</span><span class="s1">&#39;2.5</span><span class="si">% c</span><span class="s1">i&#39;</span><span class="p">:</span><span class="n">a_min</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="n">q_vals</span><span class="p">[</span><span class="n">a_rank</span><span class="p">],</span> <span class="s1">&#39;97.5</span><span class="si">% c</span><span class="s1">i&#39;</span><span class="p">:</span> <span class="n">a_max</span><span class="p">}})</span>

<span class="c1"># make df</span>
<span class="n">p_cis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">the_cis</span><span class="p">)</span>
<span class="n">p_cis</span> <span class="o">=</span> <span class="n">p_cis</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
<span class="n">p_cis</span><span class="p">[</span><span class="s1">&#39;b-method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span>
<span class="n">p_cis</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Below top:</strong> Confidence intervals calculated by resampling the survey results 5,000 times for each condition. <strong>Below bottom:</strong> The same intervals using the bias corrected method.</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">axone</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">axtwo</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">p_cis</span><span class="o">.</span><span class="n">values</span>
<span class="n">sut</span><span class="o">.</span><span class="n">hide_spines_ticks_grids</span><span class="p">(</span><span class="n">axone</span><span class="p">)</span>
<span class="n">sut</span><span class="o">.</span><span class="n">hide_spines_ticks_grids</span><span class="p">(</span><span class="n">axtwo</span><span class="p">)</span>
<span class="n">colLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="sa">F</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s2">&quot;^</span><span class="si">{th}</span><span class="s2">$&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_cis</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">colLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">)</span>

<span class="n">table_one</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">make_a_table</span><span class="p">(</span><span class="n">axone</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="n">colLabels</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">.25</span><span class="p">,</span><span class="o">*</span><span class="p">[</span><span class="mf">.15</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">table_two</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">make_a_table</span><span class="p">(</span><span class="n">axtwo</span><span class="p">,</span> <span class="n">bcas</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="n">colLabels</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">.25</span><span class="p">,</span><span class="o">*</span><span class="p">[</span><span class="mf">.15</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">table_one</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="n">table_two</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>    
                        
<span class="n">table_one</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot;Percentile&quot;</span><span class="p">)</span>
<span class="n">table_two</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot;BCa&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/baselines_22_0.png" src="_images/baselines_22_0.png" />
</div>
</div>
<p><em><strong>Below:</strong> Confidence interval example value: the survey result at Biel on 31-01-2021 was greater than the median value for all the surveys, it exceeded the the confidence interval of the the 50<sup>th</sup> percentile. There were 123 objects (pcs) collected over 40 meters (m) of shoreline. First the survey value is converted to <strong>pieces of litter per meter (pcs/m)</strong> and then multiplied by the required number of meters (100).</em></p>
<p><span class="math notranslate nohighlight">\((pcs/m)*100 = (123_{pcs} / 40_m)*100m \approxeq 313p/100m\)</span></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/baselines_24_0.png" src="_images/baselines_24_0.png" />
</div>
</div>
</div>
<div class="section" id="baseline-values">
<h3><span class="section-number">14.2.5. </span>Baseline values<a class="headerlink" href="#baseline-values" title="Permalink to this headline">¶</a></h3>
<p>For this set of data, the differences between the CIs calculated the BCa method or the percentile method is minimum. The BCa method will be used to report the baseline values and CIs.</p>
<div class="section" id="baseline-median-value-of-all-survey-results">
<h4><span class="section-number">14.2.5.1. </span>Baseline median value of all survey results<a class="headerlink" href="#baseline-median-value-of-all-survey-results" title="Permalink to this headline">¶</a></h4>
<p>Considering only surveys with a length greater than 10 meters and excluding objects less than 2.5cm, the median survey result of all data was 180p/100m with a CI of 147p/100m - 212p/100m. The reported baseline median value for the EU was 133p/100m, within the range of the CI of the IQAASL survey results. While the median value may be greater in Switzerland the mean value from the EU study is 504p/100m versus 341p/100m in Switzerland.<span id="id16">[<a class="reference internal" href="references.html#id42" title="van Loon W. Hanke G., Walvoort D. Eu marine beach litter baselines. Publications Office of the European Union, 2019. doi:10.2760/16903.">HG19</a>]</span></p>
<p>Suggesting that the higher extreme values were more likely in marine environment, but the expected median value from both data sets is similar.</p>
</div>
<div class="section" id="baseline-median-and-ci-per-survey-area">
<h4><span class="section-number">14.2.5.2. </span>Baseline median and CI per survey area<a class="headerlink" href="#baseline-median-and-ci-per-survey-area" title="Permalink to this headline">¶</a></h4>
<p>There were four survey areas in the IQAASL, 3 of which had more than 40 samples during the survey period.</p>
<p><em><strong>Below:</strong> The median and the 95% confidence interval of the Linth, Aare and Rhône survey areas. The Ticino survey area is not included for lack of a sufficient quantity of surveys.</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bassins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;linth&quot;</span><span class="p">,</span> <span class="s2">&quot;aare&quot;</span><span class="p">,</span> <span class="s2">&quot;rhone&quot;</span><span class="p">]</span>
<span class="n">the_sas</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">a_bassin</span> <span class="ow">in</span> <span class="n">bassins</span><span class="p">:</span>
    <span class="n">an_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a_rank</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">a_result</span> <span class="o">=</span> <span class="n">compute_bca_ci</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">dt_all</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">==</span> <span class="n">a_bassin</span><span class="p">][</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="mf">.05</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">,</span> <span class="n">stat_param</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">dt_all</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">==</span> <span class="n">a_bassin</span><span class="p">][</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">the_sas</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">a_bassin</span><span class="p">:{</span><span class="s1">&#39;2.5</span><span class="si">% c</span><span class="s1">i&#39;</span><span class="p">:</span><span class="n">a_result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="n">observed</span><span class="p">,</span> <span class="s1">&#39;97.5</span><span class="si">% c</span><span class="s1">i&#39;</span><span class="p">:</span> <span class="n">a_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]}})</span>

<span class="n">sas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">the_sas</span><span class="p">)</span>
<span class="n">sas</span><span class="p">[</span><span class="s1">&#39;b-method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bca&#39;</span>
<span class="n">sas</span> <span class="o">=</span> <span class="n">sas</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sas</span><span class="o">.</span><span class="n">values</span>
<span class="n">sut</span><span class="o">.</span><span class="n">hide_spines_ticks_grids</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>

<span class="n">the_first_table_data</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="n">sas</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">.25</span><span class="p">,</span><span class="o">*</span><span class="p">[</span><span class="mf">.15</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">a_summary_table_one</span> <span class="o">=</span> <span class="n">sut</span><span class="o">.</span><span class="n">make_a_summary_table</span><span class="p">(</span><span class="n">the_first_table_data</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">sas</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">a_color</span><span class="p">,</span> <span class="n">s_et_bottom_row</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">a_summary_table_one</span><span class="o">.</span><span class="n">get_celld</span><span class="p">()[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="n">a_summary_table_one</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/baselines_27_0.png" src="_images/baselines_27_0.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="extreme-values">
<h2><span class="section-number">14.3. </span>Extreme values<a class="headerlink" href="#extreme-values" title="Permalink to this headline">¶</a></h2>
<p>As was noted earlier, extreme values (EVs) or outliers are not excluded from the data when calculating baselines or CIs. However, identifying EVs and where and when they occur is an essential part of the monitoring process.</p>
<p>The occurrence of extreme values can influence the average of the data and the interpretation of survey results. According to the JRC report:</p>
<blockquote>
<div><p>The methodology for the identification of extreme values can be either <strong>expert judgement</strong>, or be based on statistical and modelling approaches, such as the application of Tukey’s box plots to detect potential outliers. For skewed distributions, the adjusted box plot is more appropriate. <span id="id17">[<a class="reference internal" href="references.html#id42" title="van Loon W. Hanke G., Walvoort D. Eu marine beach litter baselines. Publications Office of the European Union, 2019. doi:10.2760/16903.">HG19</a>]</span></p>
</div></blockquote>
<div class="section" id="defining-extreme-values">
<h3><span class="section-number">14.3.1. </span>Defining extreme values<a class="headerlink" href="#defining-extreme-values" title="Permalink to this headline">¶</a></h3>
<p>The references give no guidance as to the numerical value of an EV. Contrary to the target value of 20p/100m or the <span class="math notranslate nohighlight">\(15^{th}\)</span> percentile, the definition of an EV is left to the person interpreting the data. The upper limit of Tukeys boxplots (un adjusted) is <span class="math notranslate nohighlight">\(\approx 90^{th}\)</span> percentile of the data. This method is compatible with the assessment metric and boxplots are fairly easy to resolve visually.</p>
<div class="section" id="adjusted-boxplots">
<h4><span class="section-number">14.3.1.1. </span>Adjusted boxplots<a class="headerlink" href="#adjusted-boxplots" title="Permalink to this headline">¶</a></h4>
<p>Tukey’s boxplot is used to visualize the distribution of a univariate data set. The samples that fall within the first quartile (25%) and the third quartile (75%) are considered to be within the inner quartile range (IQR). Points out side of the inner quartile range are considered outliers if their value is greater or less than one of two limits:</p>
<ul class="simple">
<li><p>lower limit = <span class="math notranslate nohighlight">\(Q_1 - (1.5*IQR)\)</span></p></li>
<li><p>upper limit = <span class="math notranslate nohighlight">\(Q_3 + (1.5*IQR)\)</span></p></li>
</ul>
<p>Adjusting the boxplot involves replacing the constant 1.5 with another parameter. This parameter is calculated using a method called the <em>medcouple</em> (MC) and applying the result of that method to the constant 1.5. <span id="id18">[<a class="reference internal" href="references.html#id32" title="Mia Hubert and Ellen Vandervieren. An adjusted boxplot for skewed distributions. Computational Statistics &amp; Data Analysis, 52:5186-5201, 08 2008. doi:10.1016/j.csda.2007.11.008.">HV08</a>]</span> <span id="id19">[<a class="reference internal" href="references.html#id19" title="Skipper Seabold and Josef Perktold. Statsmodels: econometric and statistical modeling with python. URL: https://www.statsmodels.org/stable/generated/statsmodels.stats.stattools.medcouple.html.">SP</a>]</span> The new calculation looks like this:</p>
<ul class="simple">
<li><p>lower limit = <span class="math notranslate nohighlight">\(Q_1 - (1.5e^{-4MC}*IQR)\)</span></p></li>
<li><p>upper limit = <span class="math notranslate nohighlight">\(Q_3 + (1.5e^{3MC}*IQR)\)</span></p></li>
</ul>
<p>The limits are extended or reduced to better match the shape of the data. As a result, the upper and lower limits represent a wider range of values, with respect to the percentile ranking, as opposed to the unadjusted version.</p>
<p><em><strong>Below</strong>: The limit at which a survey is considered extreme extends to the 98th percentile when the boxplots are adjusted as opposed to the 90th percentile if the constant is left at 1.5.</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># implementation of medcouple</span>
<span class="n">a_whis</span> <span class="o">=</span> <span class="n">medcouple</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

<span class="c1"># get the ecdf </span>
<span class="n">ecdf</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

<span class="c1"># quantiles and IQR of the data</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span><span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>

<span class="c1"># the upper and lower limit of extreme values unadjusted:</span>
<span class="n">limit_lower</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span>
<span class="n">limit_upper</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span>

<span class="c1"># the upper and lower limit of extreme values adjusted:</span>
<span class="n">a_fence</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a_whis</span><span class="p">))))</span><span class="o">*</span><span class="n">iqr</span>
<span class="n">a_2fence</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">a_whis</span><span class="p">))))</span><span class="o">*</span><span class="n">iqr</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">box_props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;boxprops&#39;</span><span class="p">:{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;magenta&#39;</span><span class="p">},</span>
    <span class="s1">&#39;medianprops&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;magenta&#39;</span><span class="p">},</span>
    <span class="s1">&#39;whiskerprops&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;magenta&#39;</span><span class="p">},</span>
    <span class="s1">&#39;capprops&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;magenta&#39;</span><span class="p">}</span>
<span class="p">}</span>

<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dt_all</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="mf">.35</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dt_all</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">box_props</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">a_2fence</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mf">.25</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mf">.75</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">unit_label</span><span class="p">,</span> <span class="o">**</span><span class="n">ck</span><span class="o">.</span><span class="n">xlab_k14</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_2fence</span><span class="o">+</span><span class="mi">200</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;Adjusted&quot;</span><span class="p">,</span>
                  <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_2fence</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                  <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">.2</span><span class="p">,</span><span class="n">a_2fence</span><span class="o">-</span><span class="mi">400</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                  <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                  <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round4&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
                  <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span>
                                  <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-0.2&quot;</span><span class="p">,</span>
                                  <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;Not Adjusted&quot;</span><span class="p">,</span>
                  <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit_upper</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                  <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span><span class="n">limit_upper</span><span class="o">+</span><span class="mi">400</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                  <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                  <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round4&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
                  <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span>
                                  <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-0.2&quot;</span><span class="p">,</span>
                                  <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/baselines_29_0.png" src="_images/baselines_29_0.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<p><em>The difference between adjusted and normal boxplots. Adjusted = 1507 p/100m,  unadjusted = 755 p/100m.</em></p>
</div>
</div>
<p>Using the adjusted boxplots pushes the extreme value threshold (EVT) to over 1600p/100m. However, the unadjusted boxplots fall within the CI of the expected value of the 90<sup>th</sup> percentile of the survey data.</p>
<p><em><strong>Below:</strong> adjusted extreme values example St. Gingolph, 08-12-2020. There were 514 objects (pcs) collected over 31 meteres (m) of shoreline. First the survey value is converted to <strong>pieces of trash per meter (pcs/m)</strong> and then multiplied by the required number of meters (100):</em></p>
<p><span class="math notranslate nohighlight">\((pcs/m)*100 = (514_{pcs} / 31_m)*100m \approxeq 1652p/100m\)</span></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/baselines_33_0.png" src="_images/baselines_33_0.png" />
</div>
</div>
</div>
<div class="section" id="modeling">
<h4><span class="section-number">14.3.1.2. </span>Modeling<a class="headerlink" href="#modeling" title="Permalink to this headline">¶</a></h4>
<p>Extreme values can be identified by assuming the data belong to some underlying known statistical distribution. In general count data are assumed to be Poisson distributed or a form very similar. The Poisson distribution assumes that the mean = the variance. The data from IQAASL and beach-litter data in general have a high variance usually greater than the mean.</p>
<p>The negative binomial (NB) distribution does not have such a requirement. The NB is a Poisson distribution with parameter λ, where λ itself is not fixed but a random variable which follows a Gamma distribution. <span id="id20">[<a class="reference internal" href="references.html#id20" title="A. Cameron and Pravin Trivedi. Regression analysis of count data. 2nd ed, pages 200. Volume 41. cambridge, 09 1999. doi:10.1017/CBO9780511814365.">CT99</a>]</span> <span id="id21">[<a class="reference internal" href="references.html#id21" title="Eric W. Weisstein. &quot;negative binomial distribution.&quot; from mathworld–a wolfram web resource. 2020. URL: https://mathworld.wolfram.com/NegativeBinomialDistribution.html.">Wei20</a>]</span> <span id="id22">[<a class="reference internal" href="references.html#id23" title="Scipy nbimon. Scipy stats nbinom. URL: https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.nbinom.html.">nbi</a>]</span></p>
<blockquote>
<div><p>The modelling approach for the identification of extreme values is then performed by fitting the NB-distribution to the data by means of maximum likelihood (MLE) and tagging all values in the right tail as potentially extreme values if the probability that they belong to the fitted NB-distribution is less than, e.g. 0.001. <span id="id23">[<a class="reference internal" href="references.html#id44" title="Fleet D. Van Loon W., Hanke G. A european threshold value and assessment method for macro litter on coastlines. Publications Office of the European Union, 2020.">VLW20</a>]</span></p>
</div></blockquote>
<p>The MLE is one of two recommended methods of modeling or fitting data values to an assumed distribution:</p>
<ol class="simple">
<li><p>Method of moments (MOM)</p></li>
<li><p>MLE: maximum likelihood estimation</p></li>
</ol>
<div class="section" id="method-of-moments">
<h5><span class="section-number">14.3.1.2.1. </span>Method of moments<a class="headerlink" href="#method-of-moments" title="Permalink to this headline">¶</a></h5>
<p>The method of moments assumes that the parameters derived from the sample are close or similar to the population parameters. In the case of beach-litter surveys that means the sample median, mean and variance could be considered close approximations of the actual values if all the beaches on all the lakes and streams were surveyed.</p>
<p>Concretely, the parameters of a probable distribution model are estimated by calculating them from the sample data. This method is easy to apply because most of the parameter calculations for the most common distributions are well known. <span id="id24">[<a class="reference internal" href="references.html#id17" title="Srikanta Mishra and Akhil Datta-Gupta. Chapter 3 - distributions and models thereof. In Srikanta Mishra and Akhil Datta-Gupta, editors, Applied Statistical Modeling and Data Analytics, pages 31-67. Elsevier, 2018. URL: https://www.sciencedirect.com/science/article/pii/B9780128032794000031, doi:https://doi.org/10.1016/B978-0-12-803279-4.00003-1.">MDG18</a>]</span> <span id="id25">[<a class="reference internal" href="references.html#id25" title="Pauli Virtanen, Ralf Gommers, Travis E. Oliphant, Matt Haberland, Tyler Reddy, David Cournapeau, Evgeni Burovski, Pearu Peterson, Warren Weckesser, Jonathan Bright, Stéfan J. van der Walt, Matthew Brett, Joshua Wilson, K. Jarrod Millman, Nikolay Mayorov, Andrew R. J. Nelson, Eric Jones, Robert Kern, Eric Larson, C J Carey, İlhan Polat, Yu Feng, Eric W. Moore, Jake VanderPlas, Denis Laxalde, Josef Perktold, Robert Cimrman, Ian Henriksen, E. A. Quintero, Charles R. Harris, Anne M. Archibald, Antônio H. Ribeiro, Fabian Pedregosa, Paul van Mulbregt, and SciPy 1.0 Contributors. SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python. Nature Methods, 17:261–272, 2020. doi:10.1038/s41592-019-0686-2.">VGO+20</a>]</span> <span id="id26">[<a class="reference internal" href="references.html#id24" title="Stack-Overflow. Fitting for discrete data: negative binomial, poisson, geometric distribution. URL: https://stackoverflow.com/questions/59308441/fitting-for-discrete-data-negative-binomial-poisson-geometric-distribution.">SO</a>]</span></p>
</div>
<div class="section" id="maximum-likelihood-estimation">
<h5><span class="section-number">14.3.1.2.2. </span>Maximum likelihood estimation<a class="headerlink" href="#maximum-likelihood-estimation" title="Permalink to this headline">¶</a></h5>
<p>MLE is a method of estimating the parameters of a statistical model given some data, in that way it is not different than the MOM. The difference is that in the MOM the model parameters are calculated from the data, in MLE the parameters are chosen by finding the parameters that make the data most likely given the statistical model.</p>
<p>This method is more computationally involved than the MOM but has some advantages:</p>
<ul class="simple">
<li><p>If the model is correctly assumed, the MLE is the most efficient estimator.</p></li>
<li><p>It results in unbiased estimates in larger samples.</p></li>
</ul>
<p><em><strong>Fitting the data to the underlying NB distribution.</strong> The observed survey results are compared to the estimated survey results using the method of moments and maximum likelihood estimation. <strong>Left:</strong> histogram of simulated results compared to observed data. <strong>Right:</strong> distribution of results compared to observed data with the 90<sup>th</sup> percentile.</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># implementaion of MLE</span>
<span class="c1"># https://github.com/pnxenopoulos/negative_binomial/blob/master/negative_binomial/core.py</span>

<span class="k">def</span> <span class="nf">r_derv</span><span class="p">(</span><span class="n">r_var</span><span class="p">,</span> <span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Function that represents the derivative of the negbinomial likelihood</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">total_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">obs_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>  <span class="c1"># Save the mean of the data</span>
    <span class="n">n_pop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span>  <span class="c1"># Save the length of the vector, n_pop</span>

    <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">:</span>
        <span class="n">total_sum</span> <span class="o">+=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">obs</span> <span class="o">+</span> <span class="n">r_var</span><span class="p">)</span>

    <span class="n">total_sum</span> <span class="o">-=</span> <span class="n">n_pop</span><span class="o">*</span><span class="n">digamma</span><span class="p">(</span><span class="n">r_var</span><span class="p">)</span>
    <span class="n">total_sum</span> <span class="o">+=</span> <span class="n">n_pop</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r_var</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_var</span> <span class="o">+</span> <span class="n">obs_mean</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">total_sum</span>

<span class="k">def</span> <span class="nf">p_equa</span><span class="p">(</span><span class="n">r_var</span><span class="p">,</span> <span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Function that represents the equation for p in the negbin likelihood</span>
<span class="sd">     &#39;&#39;&#39;</span>
    <span class="n">data_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
    <span class="n">n_pop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span>
    <span class="n">p_var</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">data_sum</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_pop</span> <span class="o">*</span> <span class="n">r_var</span> <span class="o">+</span> <span class="n">data_sum</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p_var</span>

<span class="k">def</span> <span class="nf">neg_bin_fit</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Function to fit negative binomial to data</span>
<span class="sd">    vec: the data vector used to fit the negative binomial distribution</span>
<span class="sd">   </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">est_r</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">r_derv</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">vec</span><span class="p">,))</span>
    <span class="n">est_p</span> <span class="o">=</span> <span class="n">p_equa</span><span class="p">(</span><span class="n">est_r</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">est_r</span><span class="p">,</span> <span class="n">est_p</span>

<span class="c1"># the data to model</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">dt_all</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># the variance</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="c1"># the average</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="c1"># dispersion</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="o">/</span><span class="n">var</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">var</span><span class="o">-</span><span class="n">mean</span><span class="p">))</span>

<span class="c1"># implementation of method of moments</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>

<span class="c1"># format data for charting</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">unit_label</span><span class="p">:</span><span class="n">vals</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;observed&#39;</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">unit_label</span><span class="p">:</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;MOM&#39;</span><span class="p">})])</span>

<span class="n">scp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="s1">&#39;MOM&#39;</span><span class="p">][</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="s1">&#39;observed&#39;</span><span class="p">][</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">scpsx</span> <span class="o">=</span> <span class="p">[{</span><span class="n">unit_label</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span><span class="s1">&#39;MOM&#39;</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scp</span><span class="p">]</span>
<span class="n">obsx</span> <span class="o">=</span> <span class="p">[{</span><span class="n">unit_label</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span><span class="s1">&#39;observed&#39;</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">]</span>

<span class="c1"># ! implementation of MLE</span>
<span class="n">estimated_r</span><span class="p">,</span> <span class="n">estimated_p</span> <span class="o">=</span> <span class="n">neg_bin_fit</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">init</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">)</span>

<span class="c1"># ! use the MLE estimators to generate data</span>
<span class="n">som_data</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">estimated_r</span><span class="p">,</span> <span class="n">estimated_p</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dt_all</span><span class="p">))</span>
<span class="n">som_datax</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="n">unit_label</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span><span class="s1">&#39;MLE&#39;</span><span class="p">}</span>  <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">som_data</span><span class="p">])</span>

<span class="c1"># combined the different results in to one df</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scpsx</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">obsx</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">som_datax</span><span class="p">)])</span>
<span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># the 90th</span>
<span class="n">ev</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">.9</span><span class="p">)</span>
<span class="n">xval</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;MOM&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;MLE&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="n">ev</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">xval</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">box_palette</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MOM&#39;</span><span class="p">:</span><span class="s1">&#39;salmon&#39;</span><span class="p">,</span> <span class="s1">&#39;MLE&#39;</span><span class="p">:</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">:</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">axone</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">bw</span><span class="o">=</span><span class="mi">80</span>

<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">box_palette</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="n">bw</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;bars&#39;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="s1">&#39;stack&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">box_props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;boxprops&#39;</span><span class="p">:{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="s1">&#39;medianprops&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="s1">&#39;whiskerprops&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="s1">&#39;capprops&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">}</span>
<span class="p">}</span>


<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axone</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">box_palette</span><span class="p">,</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">box_props</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">unit_label</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="n">box_palette</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axone</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">axone</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ev</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ev</span><span class="p">[</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;90%&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">axone</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of samples&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ck</span><span class="o">.</span><span class="n">xlab_k14</span><span class="p">)</span>
<span class="n">axone</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">unit_label</span><span class="p">,</span> <span class="o">**</span><span class="n">ck</span><span class="o">.</span><span class="n">xlab_k14</span><span class="p">)</span>

<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axone</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">axone</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">h3</span><span class="o">=</span><span class="n">handles</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">hlast</span><span class="o">=</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">axone</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">axone</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">l3</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">llast</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">axone</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="o">*</span><span class="n">h3</span><span class="p">,</span> <span class="o">*</span><span class="n">hlast</span><span class="p">],</span> <span class="p">[</span><span class="o">*</span><span class="n">l3</span><span class="p">,</span> <span class="o">*</span><span class="n">llast</span><span class="p">],</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">.48</span><span class="p">,</span> <span class="mf">.96</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/baselines_36_0.png" src="_images/baselines_36_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evx</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>

<span class="n">pnt</span> <span class="o">=</span>  <span class="sa">F</span><span class="s2">&quot;&quot;&quot;*90% p/100m: &amp;nbsp;MLE=</span><span class="si">{</span><span class="n">evx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;MLE&#39;</span><span class="p">][</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">,  &amp;nbsp;Observed=</span><span class="si">{</span><span class="n">evx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">][</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">,  &amp;nbsp;MOM=</span><span class="si">{</span><span class="n">evx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;MOM&#39;</span><span class="p">][</span><span class="n">unit_label</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">*&quot;&quot;&quot;</span>
<span class="n">md</span><span class="p">(</span><span class="n">pnt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p><em>90% p/100m:  MLE=860,   Observed=727,   MOM=878</em></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="implementation">
<h2><span class="section-number">14.4. </span>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The proposed, assessment metrics and evaluation methods for beach litter survey results are similar and compatible with the methods previously implemented in Switzerland. This first analysis has shown that:</p>
<ol class="simple">
<li><p>Methods proposed by the EU to monitor litter are applicable in Switzerland</p></li>
<li><p>Confidence intervals and baselines can be calculated for different survey areas</p></li>
<li><p>Aggregated results can be compared between regions</p></li>
</ol>
<p>Once the BV for a survey area is calculated all samples that are conducted within that survey area can be compared directly to it. It is the case in 2020 - 2021 that the survey areas in Switzerland have different median baselines. This situation is analogous to the EU with respect to the differences between different regions and administrative areas of the continent.</p>
<p>By applying the proposed methods to the current results from IQAASL the objects of concern can be identified for each survey area.</p>
<p><em><strong>Below:</strong> Comparing the baseline values of the most common objects. All survey areas 2020 - 2021. The Ticino/Cerisio survey area has less than 100 surveys. <strong>units= p/100m</strong></em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/baselines_40_0.png" src="_images/baselines_40_0.png" />
</div>
</div>
<p>The expected median value per survey and the median value of the most common objects per survey is higher in the Rhône survey area. When the median value is used the BV also reveals that 2/12 most common objects were found in less than 50% of the surveys nationally, those with a median value of zero.</p>
<p>The method can be scaled vertically giving a more detailed view of a survey area. The method of calculation remains the same therefore comparisons are valid from the lake to the national level.</p>
<p><em><strong>Below:</strong> Comparing the baseline values of the most common objects. Aare survey area lakes and rivers 2020 - 2021. Locations with more than 30 surveys: Bielersee, Neuenburgersee and Thunersee.</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/baselines_43_0.png" src="_images/baselines_43_0.png" />
</div>
</div>
<p>The recommended minimum number of surveys (40) per sampling period is to ensure that BV calculations are based on enough samples, this is important because of the high variability of beach litter surveys.</p>
<p>The sampling period for IQAASL was March through May 2020 - 2021. With respect to the minimum number of samples there are three baseline values for the Aare survey area:</p>
<ol class="simple">
<li><p>Bielersee</p></li>
<li><p>Neuenburgersee</p></li>
<li><p>The Aare survey area</p></li>
</ol>
<p>For assessment purposes this means that one sample can serve as a spot assessment and the results can be compared to any of the regional baselines directly, providing instant feedback. This type of assessment simplifies the process and empowers local stakeholders to carry out independent assessments, draw conclusions and define mitigation strategies based on the results of the established BV for the survey area.</p>
<p>In the previous examples no threshold values or extreme values are indicated. Values greater than zero are the expected median amount of that object for every measured unit. A zero value indicates that the object was found in less than 50% of the surveys. The percentile ranking for a particular object can be inferred by reading the table of values in the horizontal direction.</p>
<p>How meaningful these results are to the assessment of mitigation strategies depends on the number and quality of samples. Stakeholders at the municipal or local level need detailed data about specific objects. While national and international stakeholders tend to use broader aggregated groups.</p>
<p>The quality of the data is directly related to the training and support of the surveyors. The identification process requires some expertise as many objects and materials are not familiar to the average person. A core team of experienced surveyors to assist in the development and training ensures surveys are conducted consistently over time.</p>
<p>The monitoring program in Switzerland has managed to keep pace with developments on the continent, there are however many areas of improvement:</p>
<ol class="simple">
<li><p>Defining a standardized reporting method for municipal, cantonal and federal stakeholders</p></li>
<li><p>Define monitoring or assessment goals</p></li>
<li><p>Formalize the data repository and the method for implementation at different administrative levels</p></li>
<li><p>Develop a network of associations that share the responsibility and resources for surveying the territory</p></li>
<li><p>Develop and implement a formal training program for surveyors</p></li>
<li><p>Determine, in collaboration with academic partners, ideal sampling scenarios and research needs</p></li>
<li><p>Develop a financing method to conduct the recommended minimum number of surveys (40), per sampling period, per survey area to ensure accurate assessments can be made and research requirements are met.</p></li>
</ol>
<p>Changes in beach-litter survey results are signals and using baseline values helps identify the magnitude of those signals. However, without any context or additional information these signals may appear random.</p>
<p>Expert judgment includes the ability to place survey results in the context of local events and topography. This capacity of discernment with regards to the data and the environment is essential to identifying potential sources and priorities.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="zurichsee.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">13. </span>Zurichsee</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="key_indicators.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">15. </span>Key statistical indicators</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      <div class="extra_footer">
        <p>
   Comissioned by the Swiss Federal Office for the Environment (FOEN), © 2021
</p>

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>